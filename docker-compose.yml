# GENERATED FILE - DO NOT EDIT. Source: templates/docker-compose.yml.tmpl
services:
  xg2g:
    image: ghcr.io/manugh/xg2g:3.1.7
    container_name: xg2g
    restart: unless-stopped
    ports:
      - "8088:8088"
    # Production compose: deterministic paths (use docker-compose.dev.yml for local overrides).
    env_file:
      - /etc/xg2g/xg2g.env
    environment:
      - XG2G_DATA=/var/lib/xg2g
      - XG2G_LOG_LEVEL=info
      - XG2G_FFMPEG_BIN=/usr/local/bin/ffmpeg
      - XG2G_FFPROBE_BIN=/usr/local/bin/ffprobe
      - FFMPEG_HOME=/opt/ffmpeg
    volumes:
      - /var/lib/xg2g:/var/lib/xg2g
      - /media/nfs-recordings:/media/nfs-recordings
      # Optional: Mount a custom config
      # - ./config.yaml:/var/lib/xg2g/config.yaml:ro
    # Container hardening (Operator-Grade 2026). Persist only via mounted volumes/tmpfs.
    read_only: true
    tmpfs:
      - /tmp
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges:true
    init: true
    healthcheck:
      test: ["CMD", "xg2g", "healthcheck", "-mode", "live"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 60s
