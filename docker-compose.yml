version: '3.8'

services:
  xg2g:
    image: ghcr.io/manugh/xg2g:latest
    container_name: xg2g
    ports:
      - "34400:34400"
    volumes:
      - ./data:/data:rw
      - /etc/localtime:/etc/localtime:ro
    environment:
      - XG2G_OWI_BASE=${XG2G_OWI_BASE:-http://10.10.55.57}
      - XG2G_BOUQUET=${XG2G_BOUQUET:-Premium}
      - XG2G_DATA=/data
      - XG2G_XMLTV=${XG2G_XMLTV:-/data/guide.xml}
      - XG2G_FUZZY_MAX=${XG2G_FUZZY_MAX:-2}
      - XG2G_PICON_BASE=${XG2G_PICON_BASE:-}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:34400/api/status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Optional: Production mit Reverse Proxy
  xg2g-prod:
    image: ghcr.io/manugh/xg2g:latest
    ports:
      - "34400:34400"
    volumes:
      - xg2g_data:/data
    environment:
      - XG2G_OWI_BASE=${XG2G_OWI_BASE}
      - XG2G_BOUQUET=${XG2G_BOUQUET}
      - XG2G_DATA=/data
    configs:
      - source: xg2g_config
        target: /data/config.env
    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 128M
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  xg2g_data:

configs:
  xg2g_config:
    external: true
