# cSpell:ignore healthcheck curlimages
services:
  xg2g:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        VERSION: "${VERSION:-dev}"
    image: xg2g:local
    container_name: xg2g-1-xg2g-1
    ports:
      - "8080:8080"
      - "9090:9090"
    volumes:
      - ./data:/data
      - ./test/picons:/data/picons # Mount test picons
    environment:
      - XG2G_DATA=/data
      - XG2G_OWI_BASE=http://10.10.55.57
      - XG2G_OWI_TIMEOUT_MS=30000
      - XG2G_BOUQUET=Premium
      - XG2G_LISTEN=:8080
      - XG2G_METRICS_LISTEN=:9090
      - XG2G_API_TOKEN=super-secret-token-do-not-use-in-prod
      - XG2G_XMLTV_PATH=xmltv.xml
      - XG2G_PICON_BASE_URL=http://localhost:8080/files/picons
      - XG2G_DEBUG=true
      - XG2G_INITIAL_REFRESH=true
    healthcheck:
      test: >
        wget -q --spider -T 5 -O /dev/null http://localhost:8080/readyz || exit 1
      interval: 15s
      timeout: 10s
      retries: 3
      start_period: 5s
    restart: unless-stopped
    user: "1000"
    read_only: true
    tmpfs:
      - /tmp:size=16M,mode=1777
