=== RUN   TestAdmissionIntegration
=== RUN   TestAdmissionIntegration/Engine_Disabled_->_503
{"level":"info","service":"xg2g","version":"","serviceRef":"1:0:1:0:0:0:0:0:0:0:http://example.com/stream","code":"ADMISSION_ENGINE_DISABLED","time":"2026-02-01T14:41:25+01:00","message":"admission rejected"}
=== RUN   TestAdmissionIntegration/Sessions_Full_->_503
{"level":"info","service":"xg2g","version":"","serviceRef":"1:0:1:0:0:0:0:0:0:0:http://example.com/stream","code":"ADMISSION_SESSIONS_FULL","time":"2026-02-01T14:41:25+01:00","message":"admission rejected"}
=== RUN   TestAdmissionIntegration/No_Tuners_->_503
{"level":"info","service":"xg2g","version":"","serviceRef":"1:0:1:0:0:0:0:0:0:0:http://example.com/stream","code":"ADMISSION_NO_TUNERS","time":"2026-02-01T14:41:25+01:00","message":"admission rejected"}
=== RUN   TestAdmissionIntegration/State_Unknown_(Fail-Closed)_->_503
{"level":"error","service":"xg2g","version":"","error":"assert.AnError general error for testing","time":"2026-02-01T14:41:25+01:00","message":"admission state snapshot failed, failing closed"}
{"level":"info","service":"xg2g","version":"","serviceRef":"1:0:1:0:0:0:0:0:0:0:http://example.com/stream","code":"ADMISSION_STATE_UNKNOWN","time":"2026-02-01T14:41:25+01:00","message":"admission rejected"}
--- PASS: TestAdmissionIntegration (0.00s)
    --- PASS: TestAdmissionIntegration/Engine_Disabled_->_503 (0.00s)
    --- PASS: TestAdmissionIntegration/Sessions_Full_->_503 (0.00s)
    --- PASS: TestAdmissionIntegration/No_Tuners_->_503 (0.00s)
    --- PASS: TestAdmissionIntegration/State_Unknown_(Fail-Closed)_->_503 (0.00s)
=== RUN   TestSecurityFailClosedInvariant
=== RUN   TestSecurityFailClosedInvariant/401_Unauthorized_Must_Not_Call_Resolver
=== RUN   TestSecurityFailClosedInvariant/403_Forbidden_Must_Not_Call_Resolver
--- PASS: TestSecurityFailClosedInvariant (0.00s)
    --- PASS: TestSecurityFailClosedInvariant/401_Unauthorized_Must_Not_Call_Resolver (0.00s)
    --- PASS: TestSecurityFailClosedInvariant/403_Forbidden_Must_Not_Call_Resolver (0.00s)
=== RUN   TestLANGuard_UntrustedProxy
=== RUN   TestLANGuard_UntrustedProxy/trusted_proxy_honors_xff
=== RUN   TestLANGuard_UntrustedProxy/untrusted_proxy_ignores_xff
=== RUN   TestLANGuard_UntrustedProxy/chained_proxy_right_to_left
--- PASS: TestLANGuard_UntrustedProxy (0.00s)
    --- PASS: TestLANGuard_UntrustedProxy/trusted_proxy_honors_xff (0.00s)
    --- PASS: TestLANGuard_UntrustedProxy/untrusted_proxy_ignores_xff (0.00s)
    --- PASS: TestLANGuard_UntrustedProxy/chained_proxy_right_to_left (0.00s)
=== RUN   TestAuthEnforcement_TableDriven
=== RUN   TestAuthEnforcement_TableDriven/control_plane_start_intent_no_token_->_401
{"level":"warn","service":"xg2g","version":"","component":"auth","event":"auth.missing_header","time":"2026-02-01T14:41:25+01:00","message":"authorization header/cookie missing"}
=== RUN   TestAuthEnforcement_TableDriven/control_plane_start_intent_read_token_->_403
{"level":"warn","service":"xg2g","version":"","component":"authz","required_scopes":["v3:write"],"token_scopes":["v3:read"],"time":"2026-02-01T14:41:25+01:00","message":"insufficient scopes for request"}
=== RUN   TestAuthEnforcement_TableDriven/hls_playlist_no_token_->_401
{"level":"warn","service":"xg2g","version":"","component":"auth","event":"auth.missing_header","time":"2026-02-01T14:41:25+01:00","message":"authorization header/cookie missing"}
=== RUN   TestAuthEnforcement_TableDriven/hls_segment_no_token_->_401
{"level":"warn","service":"xg2g","version":"","component":"auth","event":"auth.missing_header","time":"2026-02-01T14:41:25+01:00","message":"authorization header/cookie missing"}
=== RUN   TestAuthEnforcement_TableDriven/metrics_not_exposed
--- PASS: TestAuthEnforcement_TableDriven (0.00s)
    --- PASS: TestAuthEnforcement_TableDriven/control_plane_start_intent_no_token_->_401 (0.00s)
    --- PASS: TestAuthEnforcement_TableDriven/control_plane_start_intent_read_token_->_403 (0.00s)
    --- PASS: TestAuthEnforcement_TableDriven/hls_playlist_no_token_->_401 (0.00s)
    --- PASS: TestAuthEnforcement_TableDriven/hls_segment_no_token_->_401 (0.00s)
    --- PASS: TestAuthEnforcement_TableDriven/metrics_not_exposed (0.00s)
=== RUN   TestV3WriteRouteRequiresWriteScope
{"level":"warn","service":"xg2g","version":"","component":"authz","required_scopes":["v3:write"],"token_scopes":["v3:read"],"time":"2026-02-01T14:41:25+01:00","message":"insufficient scopes for request"}
--- PASS: TestV3WriteRouteRequiresWriteScope (0.00s)
=== RUN   TestLANGuard_PublicEndpoints
=== RUN   TestLANGuard_PublicEndpoints/public_ip_forbidden_/api/v3/sessions
=== RUN   TestLANGuard_PublicEndpoints/lan_ip_allowed_/api/v3/sessions
--- PASS: TestLANGuard_PublicEndpoints (0.00s)
    --- PASS: TestLANGuard_PublicEndpoints/public_ip_forbidden_/api/v3/sessions (0.00s)
    --- PASS: TestLANGuard_PublicEndpoints/lan_ip_allowed_/api/v3/sessions (0.00s)
=== RUN   TestRaceSafety_ParallelIntents
=== RUN   TestRaceSafety_ParallelIntents/Phase2_Worker_Dedup_PendingIdempotency
    auth_strict_test.go:620: phase 2 idempotency not implemented yet
--- PASS: TestRaceSafety_ParallelIntents (0.00s)
    --- SKIP: TestRaceSafety_ParallelIntents/Phase2_Worker_Dedup_PendingIdempotency (0.00s)
=== RUN   TestAuthMiddleware_NoTokenConfigured
{"level":"error","service":"xg2g","version":"","event":"auth.fail_closed","time":"2026-02-01T14:41:25+01:00","message":"No API tokens configured. Denying access."}
--- PASS: TestAuthMiddleware_NoTokenConfigured (0.00s)
=== RUN   TestAuthMiddleware_MissingAuthHeader
{"level":"warn","service":"xg2g","version":"","component":"auth","event":"auth.missing_header","time":"2026-02-01T14:41:25+01:00","message":"authorization header/cookie missing"}
--- PASS: TestAuthMiddleware_MissingAuthHeader (0.00s)
=== RUN   TestAuthMiddleware_ValidBearerToken
--- PASS: TestAuthMiddleware_ValidBearerToken (0.00s)
=== RUN   TestAuthMiddleware_ValidCookie
--- PASS: TestAuthMiddleware_ValidCookie (0.00s)
=== RUN   TestAuthMiddleware_MediaRequiresSessionCookie
=== RUN   TestAuthMiddleware_MediaRequiresSessionCookie//api/v3/recordings/abc/stream.mp4/bearer-only
{"level":"warn","service":"xg2g","version":"","component":"auth","event":"auth.media_forbidden_source","source":"Authorization header (Bearer)","path":"/api/v3/recordings/abc/stream.mp4","time":"2026-02-01T14:41:25+01:00","message":"media request denied: bearer token not allowed for media (cookie required)"}
=== RUN   TestAuthMiddleware_MediaRequiresSessionCookie//api/v3/recordings/abc/stream.mp4/cookie
=== RUN   TestAuthMiddleware_MediaRequiresSessionCookie//api/v3/recordings/abc/playlist.m3u8/bearer-only
{"level":"warn","service":"xg2g","version":"","component":"auth","event":"auth.media_forbidden_source","source":"Authorization header (Bearer)","path":"/api/v3/recordings/abc/playlist.m3u8","time":"2026-02-01T14:41:25+01:00","message":"media request denied: bearer token not allowed for media (cookie required)"}
=== RUN   TestAuthMiddleware_MediaRequiresSessionCookie//api/v3/recordings/abc/playlist.m3u8/cookie
=== RUN   TestAuthMiddleware_MediaRequiresSessionCookie//api/v3/sessions/00000000-0000-0000-0000-000000000000/hls/index.m3u8/bearer-only
{"level":"warn","service":"xg2g","version":"","component":"auth","event":"auth.media_forbidden_source","source":"Authorization header (Bearer)","path":"/api/v3/sessions/00000000-0000-0000-0000-000000000000/hls/index.m3u8","time":"2026-02-01T14:41:25+01:00","message":"media request denied: bearer token not allowed for media (cookie required)"}
=== RUN   TestAuthMiddleware_MediaRequiresSessionCookie//api/v3/sessions/00000000-0000-0000-0000-000000000000/hls/index.m3u8/cookie
--- PASS: TestAuthMiddleware_MediaRequiresSessionCookie (0.00s)
    --- PASS: TestAuthMiddleware_MediaRequiresSessionCookie//api/v3/recordings/abc/stream.mp4/bearer-only (0.00s)
    --- PASS: TestAuthMiddleware_MediaRequiresSessionCookie//api/v3/recordings/abc/stream.mp4/cookie (0.00s)
    --- PASS: TestAuthMiddleware_MediaRequiresSessionCookie//api/v3/recordings/abc/playlist.m3u8/bearer-only (0.00s)
    --- PASS: TestAuthMiddleware_MediaRequiresSessionCookie//api/v3/recordings/abc/playlist.m3u8/cookie (0.00s)
    --- PASS: TestAuthMiddleware_MediaRequiresSessionCookie//api/v3/sessions/00000000-0000-0000-0000-000000000000/hls/index.m3u8/bearer-only (0.00s)
    --- PASS: TestAuthMiddleware_MediaRequiresSessionCookie//api/v3/sessions/00000000-0000-0000-0000-000000000000/hls/index.m3u8/cookie (0.00s)
=== RUN   TestAuthMiddleware_InvalidToken
{"level":"warn","service":"xg2g","version":"","component":"auth","event":"auth.invalid_token","time":"2026-02-01T14:41:25+01:00","message":"invalid api token"}
--- PASS: TestAuthMiddleware_InvalidToken (0.00s)
=== RUN   TestAuthMiddleware_EmptyScopesPrimaryToken
{"level":"warn","service":"xg2g","version":"","component":"auth","event":"auth.invalid_token","time":"2026-02-01T14:41:25+01:00","message":"invalid api token"}
--- PASS: TestAuthMiddleware_EmptyScopesPrimaryToken (0.00s)
=== RUN   TestAuthMiddleware_EmptyScopesAdditionalToken
{"level":"warn","service":"xg2g","version":"","component":"auth","event":"auth.invalid_token","time":"2026-02-01T14:41:25+01:00","message":"invalid api token"}
--- PASS: TestAuthMiddleware_EmptyScopesAdditionalToken (0.00s)
=== RUN   TestAuthMiddleware_ValidXAPIToken
--- PASS: TestAuthMiddleware_ValidXAPIToken (0.00s)
=== RUN   TestCreateSession
--- PASS: TestCreateSession (0.00s)
=== RUN   TestCreateSession_RejectsCookieOnly
--- PASS: TestCreateSession_RejectsCookieOnly (0.00s)
=== RUN   TestPutSystemConfigRejectsInvalid
--- PASS: TestPutSystemConfigRejectsInvalid (0.00s)
=== RUN   TestPutSystemConfigTriggersShutdown
{"level":"info","service":"xg2g","version":"","component":"startup-check","time":"2026-02-01T14:41:25+01:00","message":"Running pre-flight startup checks..."}
{"level":"info","service":"xg2g","version":"","component":"startup-check","path":"/tmp/TestPutSystemConfigTriggersShutdown217730769/001","time":"2026-02-01T14:41:25+01:00","message":"✓ Data directory is writable"}
{"level":"info","service":"xg2g","version":"","component":"startup-check","addr":":8088","time":"2026-02-01T14:41:25+01:00","message":"✓ API listen address is valid"}
{"level":"info","service":"xg2g","version":"","component":"startup-check","url":"http://example.com","time":"2026-02-01T14:41:25+01:00","message":"✓ OWI Base URL is valid"}
{"level":"info","service":"xg2g","version":"","component":"startup-check","time":"2026-02-01T14:41:25+01:00","message":"✅ All startup checks passed"}
{"level":"info","service":"xg2g","version":"","time":"2026-02-01T14:41:25+01:00","message":"configuration updated, triggering graceful shutdown"}
--- PASS: TestPutSystemConfigTriggersShutdown (0.00s)
=== RUN   TestPutSystemConfigDoesNotAliasCurrent
{"level":"info","service":"xg2g","version":"","component":"startup-check","time":"2026-02-01T14:41:25+01:00","message":"Running pre-flight startup checks..."}
{"level":"info","service":"xg2g","version":"","component":"startup-check","path":"/tmp/TestPutSystemConfigDoesNotAliasCurrent2565082350/001","time":"2026-02-01T14:41:25+01:00","message":"✓ Data directory is writable"}
{"level":"info","service":"xg2g","version":"","component":"startup-check","addr":":8088","time":"2026-02-01T14:41:25+01:00","message":"✓ API listen address is valid"}
{"level":"info","service":"xg2g","version":"","component":"startup-check","url":"http://example.com","time":"2026-02-01T14:41:25+01:00","message":"✓ OWI Base URL is valid"}
{"level":"info","service":"xg2g","version":"","component":"startup-check","ffmpeg":"/usr/bin/ffmpeg","time":"2026-02-01T14:41:25+01:00","message":"✓ Engine dependencies available"}
{"level":"warn","service":"xg2g","version":"","component":"startup-check","store_backend":"memory","time":"2026-02-01T14:41:25+01:00","message":"engine uses in-memory store; sessions are not persistent across restarts"}
{"level":"warn","service":"xg2g","version":"","component":"startup-check","data_dir":"/tmp/TestPutSystemConfigDoesNotAliasCurrent2565082350/001","time":"2026-02-01T14:41:25+01:00","message":"data directory is under temp; cached data and sessions may be lost on reboot"}
{"level":"info","service":"xg2g","version":"","component":"startup-check","time":"2026-02-01T14:41:25+01:00","message":"✅ All startup checks passed"}
{"level":"info","service":"xg2g","version":"","time":"2026-02-01T14:41:25+01:00","message":"configuration updated, triggering graceful shutdown"}
--- PASS: TestPutSystemConfigDoesNotAliasCurrent (0.00s)
=== RUN   TestPutSystemConfigRejectsUnknownFeatureFlags
--- PASS: TestPutSystemConfigRejectsUnknownFeatureFlags (0.00s)
=== RUN   TestPutSystemConfigRejectsInvalidFeatureFlags
=== RUN   TestPutSystemConfigRejectsInvalidFeatureFlags/Non-primitive_value
=== RUN   TestPutSystemConfigRejectsInvalidFeatureFlags/Type_mismatch_(bool_expected,_string_got)
=== RUN   TestPutSystemConfigRejectsInvalidFeatureFlags/Type_mismatch_(bool_expected,_number_got)
--- PASS: TestPutSystemConfigRejectsInvalidFeatureFlags (0.00s)
    --- PASS: TestPutSystemConfigRejectsInvalidFeatureFlags/Non-primitive_value (0.00s)
    --- PASS: TestPutSystemConfigRejectsInvalidFeatureFlags/Type_mismatch_(bool_expected,_string_got) (0.00s)
    --- PASS: TestPutSystemConfigRejectsInvalidFeatureFlags/Type_mismatch_(bool_expected,_number_got) (0.00s)
=== RUN   TestDetectConflicts
=== RUN   TestDetectConflicts/No_Overlap_-_Clean
=== RUN   TestDetectConflicts/No_Overlap_-_Boundary_Touching
=== RUN   TestDetectConflicts/Exact_Duplicate
=== RUN   TestDetectConflicts/Partial_Overlap_-_Start
=== RUN   TestDetectConflicts/Partial_Overlap_-_End
=== RUN   TestDetectConflicts/Full_Containment
=== RUN   TestDetectConflicts/Contained_Within
=== RUN   TestDetectConflicts/With_Padding_-_Causes_Overlap
=== RUN   TestDetectConflicts/Ignore_Finished/Disabled
=== RUN   TestDetectConflicts/Different_ServiceRef_-_No_Conflict_(Conservative_checks)
--- PASS: TestDetectConflicts (0.00s)
    --- PASS: TestDetectConflicts/No_Overlap_-_Clean (0.00s)
    --- PASS: TestDetectConflicts/No_Overlap_-_Boundary_Touching (0.00s)
    --- PASS: TestDetectConflicts/Exact_Duplicate (0.00s)
    --- PASS: TestDetectConflicts/Partial_Overlap_-_Start (0.00s)
    --- PASS: TestDetectConflicts/Partial_Overlap_-_End (0.00s)
    --- PASS: TestDetectConflicts/Full_Containment (0.00s)
    --- PASS: TestDetectConflicts/Contained_Within (0.00s)
    --- PASS: TestDetectConflicts/With_Padding_-_Causes_Overlap (0.00s)
    --- PASS: TestDetectConflicts/Ignore_Finished/Disabled (0.00s)
    --- PASS: TestDetectConflicts/Different_ServiceRef_-_No_Conflict_(Conservative_checks) (0.00s)
=== RUN   TestProblemWrite_Hardening
{"level":"warn","service":"xg2g","version":"","key":"status","problem_type":"test/type","time":"2026-02-01T14:41:25+01:00","message":"ignoring reserved key in problem extras"}
{"level":"warn","service":"xg2g","version":"","key":"type","problem_type":"test/type","time":"2026-02-01T14:41:25+01:00","message":"ignoring reserved key in problem extras"}
{"level":"warn","service":"xg2g","version":"","key":"title","problem_type":"test/type","time":"2026-02-01T14:41:25+01:00","message":"ignoring reserved key in problem extras"}
{"level":"warn","service":"xg2g","version":"","key":"detail","problem_type":"test/type","time":"2026-02-01T14:41:25+01:00","message":"ignoring reserved key in problem extras"}
{"level":"warn","service":"xg2g","version":"","key":"instance","problem_type":"test/type","time":"2026-02-01T14:41:25+01:00","message":"ignoring reserved key in problem extras"}
{"level":"warn","service":"xg2g","version":"","key":"code","problem_type":"test/type","time":"2026-02-01T14:41:25+01:00","message":"ignoring reserved key in problem extras"}
--- PASS: TestProblemWrite_Hardening (0.00s)
=== RUN   TestV3Router_Hardening
=== RUN   TestV3Router_Hardening/404_NotFound
=== RUN   TestV3Router_Hardening/405_MethodNotAllowed
--- PASS: TestV3Router_Hardening (0.00s)
    --- PASS: TestV3Router_Hardening/404_NotFound (0.00s)
    --- PASS: TestV3Router_Hardening/405_MethodNotAllowed (0.00s)
=== RUN   TestV3RFC7807Compliance
--- PASS: TestV3RFC7807Compliance (0.05s)
=== RUN   TestContract_AddTimer
=== RUN   TestContract_AddTimer/23_InvalidJSON_400
    contract_v3_dvr_add_timer_test.go:69: Response: Status=400 Body=map[code:INVALID_INPUT detail:The request body is malformed or empty instance:/api/v3/dvr/timers requestId:FALLBACK-TRUTH-MISSING status:400 title:Invalid Request Body type:dvr/invalid_input]
=== RUN   TestContract_AddTimer/24_InvalidTime_422
    contract_v3_dvr_add_timer_test.go:80: Response: Status=422 Body=map[code:INVALID_TIME detail:Begin time must be before end time instance:/api/v3/dvr/timers requestId:FALLBACK-TRUTH-MISSING status:422 title:Invalid Timer Time type:dvr/invalid_time]
=== RUN   TestContract_AddTimer/25_ReceiverUnreachable_DuplicateCheck_502
{"level":"error","service":"xg2g","version":"","error":"connection reset by peer","time":"2026-02-01T14:41:25+01:00","message":"failed to fetch timers for duplicate check"}
    contract_v3_dvr_add_timer_test.go:97: Response: Status=502 Body=map[code:RECEIVER_UNREACHABLE detail:Failed to verify existing timers instance:/api/v3/dvr/timers requestId:FALLBACK-TRUTH-MISSING status:502 title:Receiver Unreachable type:dvr/receiver_unreachable]
=== RUN   TestContract_AddTimer/26_Duplicate_409
    contract_v3_dvr_add_timer_test.go:116: Response: Status=409 Body=map[code:CONFLICT detail:A timer with the same parameters already exists instance:/api/v3/dvr/timers requestId:FALLBACK-TRUTH-MISSING status:409 title:Timer Conflict type:dvr/duplicate]
=== RUN   TestContract_AddTimer/27_AddConflict_409
{"level":"error","service":"xg2g","version":"","error":"Konflikt mit anderem Timer","sref":"1:0:1:C3:21:85:C00000:0:0:0:","time":"2026-02-01T14:41:25+01:00","message":"failed to add timer"}
    contract_v3_dvr_add_timer_test.go:136: Response: Status=409 Body=map[code:ADD_FAILED detail:Konflikt mit anderem Timer instance:/api/v3/dvr/timers requestId:FALLBACK-TRUTH-MISSING status:409 title:Add Timer Failed type:dvr/add_failed]
=== RUN   TestContract_AddTimer/28_AddFails_Generic_500
{"level":"error","service":"xg2g","version":"","error":"internal server error","sref":"1:0:1:C3:21:85:C00000:0:0:0:","time":"2026-02-01T14:41:25+01:00","message":"failed to add timer"}
    contract_v3_dvr_add_timer_test.go:154: Response: Status=500 Body=map[code:ADD_FAILED detail:internal server error instance:/api/v3/dvr/timers requestId:FALLBACK-TRUTH-MISSING status:500 title:Add Timer Failed type:dvr/add_failed]
=== RUN   TestContract_AddTimer/29_VerificationFails_502
{"level":"warn","service":"xg2g","version":"","sref":"1:0:1:C3:21:85:C00000:0:0:0:","time":"2026-02-01T14:41:25+01:00","message":"timer add verified failed"}
    contract_v3_dvr_add_timer_test.go:174: Response: Status=502 Body=map[code:RECEIVER_INCONSISTENT detail:Timer added but failed verification instance:/api/v3/dvr/timers requestId:FALLBACK-TRUTH-MISSING status:502 title:Receiver Inconsistent type:dvr/receiver_inconsistent]
=== RUN   TestContract_AddTimer/30_Success_201_ReturnsTimer
=== RUN   TestContract_AddTimer/31_PaddingApplied_BeginEndShifted
=== RUN   TestContract_AddTimer/32_ServiceRefResolution_NoColon_StillCreates
{"level":"info","service":"xg2g","version":"","path":"/tmp/TestContract_AddTimer3518947363/001/missing.m3u","search_id":"M3U_CHANNEL_ID","time":"2026-02-01T14:41:25+01:00","message":"attempting to resolve service ref from playlist"}
{"level":"warn","service":"xg2g","version":"","error":"open /tmp/TestContract_AddTimer3518947363/001/missing.m3u: no such file or directory","path":"/tmp/TestContract_AddTimer3518947363/001/missing.m3u","time":"2026-02-01T14:41:25+01:00","message":"failed to read playlist for resolution"}
--- PASS: TestContract_AddTimer (0.50s)
    --- PASS: TestContract_AddTimer/23_InvalidJSON_400 (0.00s)
    --- PASS: TestContract_AddTimer/24_InvalidTime_422 (0.00s)
    --- PASS: TestContract_AddTimer/25_ReceiverUnreachable_DuplicateCheck_502 (0.00s)
    --- PASS: TestContract_AddTimer/26_Duplicate_409 (0.00s)
    --- PASS: TestContract_AddTimer/27_AddConflict_409 (0.00s)
    --- PASS: TestContract_AddTimer/28_AddFails_Generic_500 (0.00s)
    --- PASS: TestContract_AddTimer/29_VerificationFails_502 (0.50s)
    --- PASS: TestContract_AddTimer/30_Success_201_ReturnsTimer (0.00s)
    --- PASS: TestContract_AddTimer/31_PaddingApplied_BeginEndShifted (0.00s)
    --- PASS: TestContract_AddTimer/32_ServiceRefResolution_NoColon_StillCreates (0.00s)
=== RUN   TestContract_DeleteTimer
=== RUN   TestContract_DeleteTimer/37_InvalidID_400
    contract_v3_dvr_delete_timer_test.go:25: Response: Status=400 Body=map[code:INVALID_ID detail:The provided timer ID is invalid instance:/api/v3/dvr/timers/invalid-id requestId:FALLBACK-TRUTH-MISSING status:400 title:Invalid Timer ID type:dvr/invalid_id]
=== RUN   TestContract_DeleteTimer/38_ReceiverUnreachable_502
{"level":"error","service":"xg2g","version":"","error":"connection refused","timerId":"MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA","time":"2026-02-01T14:41:25+01:00","message":"failed to delete timer"}
    contract_v3_dvr_delete_timer_test.go:42: Response: Status=502 Body=map[code:DELETE_FAILED detail:connection refused instance:/api/v3/dvr/timers/MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA requestId:FALLBACK-TRUTH-MISSING status:502 title:Receiver Unreachable type:dvr/receiver_unreachable]
=== RUN   TestContract_DeleteTimer/39_TimerNotFound_404
{"level":"error","service":"xg2g","version":"","error":"timer not found","timerId":"MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA","time":"2026-02-01T14:41:25+01:00","message":"failed to delete timer"}
    contract_v3_dvr_delete_timer_test.go:59: Response: Status=404 Body=map[code:DELETE_FAILED detail:timer not found instance:/api/v3/dvr/timers/MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA requestId:FALLBACK-TRUTH-MISSING status:404 title:Timer Not Found type:dvr/not_found]
=== RUN   TestContract_DeleteTimer/40_Success_204
--- PASS: TestContract_DeleteTimer (0.00s)
    --- PASS: TestContract_DeleteTimer/37_InvalidID_400 (0.00s)
    --- PASS: TestContract_DeleteTimer/38_ReceiverUnreachable_502 (0.00s)
    --- PASS: TestContract_DeleteTimer/39_TimerNotFound_404 (0.00s)
    --- PASS: TestContract_DeleteTimer/40_Success_204 (0.00s)
=== RUN   TestContract_PreviewConflicts
=== RUN   TestContract_PreviewConflicts/51_InvalidJSON_400
    contract_v3_dvr_preview_conflicts_test.go:26: Response: Status=400 Body=map[code:INVALID_INPUT detail:The request body is malformed or empty instance:/api/v3/dvr/timers/conflicts/preview requestId:FALLBACK-TRUTH-MISSING status:400 title:Invalid Request Body type:dvr/invalid_input]
=== RUN   TestContract_PreviewConflicts/52_InvalidTimeRange_422
    contract_v3_dvr_preview_conflicts_test.go:37: Response: Status=422 Body=map[code:INVALID_TIME detail:Begin time must be before end time instance:/api/v3/dvr/timers/conflicts/preview requestId:FALLBACK-TRUTH-MISSING status:422 title:Invalid Timer Order type:dvr/validation]
=== RUN   TestContract_PreviewConflicts/53_ReceiverUnreachable_FailClosed_502
{"level":"error","service":"xg2g","version":"","error":"timeout","time":"2026-02-01T14:41:25+01:00","message":"failed to fetch timers for conflict preview"}
    contract_v3_dvr_preview_conflicts_test.go:54: Response: Status=502 Body=map[code:RECEIVER_UNREACHABLE detail:Could not fetch existing timers for conflict check instance:/api/v3/dvr/timers/conflicts/preview requestId:FALLBACK-TRUTH-MISSING status:502 title:Receiver Unreachable type:dvr/receiver_unreachable]
=== RUN   TestContract_PreviewConflicts/54_NoConflicts_200_CanScheduleTrue
=== RUN   TestContract_PreviewConflicts/55_ConflictDetected_200_CanScheduleFalse
--- PASS: TestContract_PreviewConflicts (0.00s)
    --- PASS: TestContract_PreviewConflicts/51_InvalidJSON_400 (0.00s)
    --- PASS: TestContract_PreviewConflicts/52_InvalidTimeRange_422 (0.00s)
    --- PASS: TestContract_PreviewConflicts/53_ReceiverUnreachable_FailClosed_502 (0.00s)
    --- PASS: TestContract_PreviewConflicts/54_NoConflicts_200_CanScheduleTrue (0.00s)
    --- PASS: TestContract_PreviewConflicts/55_ConflictDetected_200_CanScheduleFalse (0.00s)
=== RUN   TestContract_UpdateTimer
=== RUN   TestContract_UpdateTimer/41_InvalidID_400
    contract_v3_dvr_update_timer_test.go:27: Response: Status=400 Body=map[code:INVALID_ID detail:The provided timer ID is invalid instance:/api/v3/dvr/timers/invalid-id requestId:FALLBACK-TRUTH-MISSING status:400 title:Invalid Timer ID type:dvr/invalid_id]
=== RUN   TestContract_UpdateTimer/42_InvalidInput_400
    contract_v3_dvr_update_timer_test.go:38: Response: Status=400 Body=map[code:INVALID_INPUT detail:The request body is malformed or empty instance:/api/v3/dvr/timers/MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA requestId:FALLBACK-TRUTH-MISSING status:400 title:Invalid Request Body type:dvr/invalid_input]
=== RUN   TestContract_UpdateTimer/43_TimerNotFound_404
    contract_v3_dvr_update_timer_test.go:55: Response: Status=404 Body=map[code:NOT_FOUND detail:The requested timer does not exist on the receiver instance:/api/v3/dvr/timers/MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA requestId:FALLBACK-TRUTH-MISSING status:404 title:Timer Not Found type:dvr/not_found]
=== RUN   TestContract_UpdateTimer/44_ReceiverUnreachable_GetTimers_502
{"level":"error","service":"xg2g","version":"","error":"timeout","time":"2026-02-01T14:41:25+01:00","message":"failed to fetch timers during update"}
    contract_v3_dvr_update_timer_test.go:72: Response: Status=502 Body=map[code:RECEIVER_UNREACHABLE detail:Failed to verify existing timer instance:/api/v3/dvr/timers/MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA requestId:FALLBACK-TRUTH-MISSING status:502 title:Receiver Unreachable type:dvr/receiver_unreachable]
=== RUN   TestContract_UpdateTimer/45_NativeUpdateSuccess_200
{"level":"info","service":"xg2g","version":"","timerId":"MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMTAwfDIxMDA","native":true,"time":"2026-02-01T14:41:25+01:00","message":"Updating timer"}
=== RUN   TestContract_UpdateTimer/46_NativeUpdateConflict_409
{"level":"info","service":"xg2g","version":"","timerId":"MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA","native":true,"time":"2026-02-01T14:41:25+01:00","message":"Updating timer"}
{"level":"error","service":"xg2g","version":"","error":"Conflict with event X","timerId":"MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA","time":"2026-02-01T14:41:25+01:00","message":"native update failed"}
    contract_v3_dvr_update_timer_test.go:121: Response: Status=409 Body=map[code:UPDATE_FAILED detail:Conflict with event X instance:/api/v3/dvr/timers/MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA requestId:FALLBACK-TRUTH-MISSING status:409 title:Update Failed type:dvr/update_failed]
=== RUN   TestContract_UpdateTimer/47_FallbackSuccess_200
{"level":"info","service":"xg2g","version":"","timerId":"MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA","native":false,"time":"2026-02-01T14:41:25+01:00","message":"Updating timer"}
{"level":"info","service":"xg2g","version":"","timerId":"MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA","time":"2026-02-01T14:41:25+01:00","message":"performing delete+add fallback for update"}
=== RUN   TestContract_UpdateTimer/48_FallbackAddConflict_Rollback_409
{"level":"info","service":"xg2g","version":"","timerId":"MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA","native":false,"time":"2026-02-01T14:41:25+01:00","message":"Updating timer"}
{"level":"info","service":"xg2g","version":"","timerId":"MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA","time":"2026-02-01T14:41:25+01:00","message":"performing delete+add fallback for update"}
{"level":"error","service":"xg2g","version":"","error":"Conflict","timerId":"MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA","time":"2026-02-01T14:41:25+01:00","message":"fallback add failed, attempting rollback"}
=== RUN   TestContract_UpdateTimer/50_VerificationFails_502
{"level":"info","service":"xg2g","version":"","timerId":"MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA","native":true,"time":"2026-02-01T14:41:25+01:00","message":"Updating timer"}
{"level":"warn","service":"xg2g","version":"","timerId":"MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA","time":"2026-02-01T14:41:26+01:00","message":"timer update verification failed"}
    contract_v3_dvr_update_timer_test.go:203: Response: Status=502 Body=map[code:RECEIVER_INCONSISTENT detail:Timer updated but failed verification instance:/api/v3/dvr/timers/MTowOjE6QzM6MjE6ODU6QzAwMDAwOjA6MDowOnwxMDAwfDIwMDA requestId:FALLBACK-TRUTH-MISSING status:502 title:Inconsistent Receiver State type:dvr/receiver_inconsistent]
--- PASS: TestContract_UpdateTimer (0.50s)
    --- PASS: TestContract_UpdateTimer/41_InvalidID_400 (0.00s)
    --- PASS: TestContract_UpdateTimer/42_InvalidInput_400 (0.00s)
    --- PASS: TestContract_UpdateTimer/43_TimerNotFound_404 (0.00s)
    --- PASS: TestContract_UpdateTimer/44_ReceiverUnreachable_GetTimers_502 (0.00s)
    --- PASS: TestContract_UpdateTimer/45_NativeUpdateSuccess_200 (0.00s)
    --- PASS: TestContract_UpdateTimer/46_NativeUpdateConflict_409 (0.00s)
    --- PASS: TestContract_UpdateTimer/47_FallbackSuccess_200 (0.00s)
    --- PASS: TestContract_UpdateTimer/48_FallbackAddConflict_Rollback_409 (0.00s)
    --- PASS: TestContract_UpdateTimer/50_VerificationFails_502 (0.50s)
=== RUN   TestRFC7807_HeaderAssert
--- PASS: TestRFC7807_HeaderAssert (0.00s)
=== RUN   TestContract_StopStream_DeleteStreamsId
=== RUN   TestContract_StopStream_DeleteStreamsId/13_InvalidID_Empty
    contract_v3_streams_stop_test.go:90: Response: Status=400 Body=map[code:INVALID_SESSION_ID detail:The provided session ID contains unsafe characters instance:/api/v3/streams/ requestId:FALLBACK-TRUTH-MISSING status:400 title:Invalid Session ID type:streams/invalid_id]
=== RUN   TestContract_StopStream_DeleteStreamsId/14_InvalidID_Unsafe
    contract_v3_streams_stop_test.go:102: Response: Status=400 Body=map[code:INVALID_SESSION_ID detail:The provided session ID contains unsafe characters instance:/api/v3/streams/../unsafe requestId:FALLBACK-TRUTH-MISSING status:400 title:Invalid Session ID type:streams/invalid_id]
=== RUN   TestContract_StopStream_DeleteStreamsId/15_ControlPlaneDisabled_NoStore
    contract_v3_streams_stop_test.go:112: Response: Status=503 Body=map[code:UNAVAILABLE detail:V3 control plane is not enabled instance:/api/v3/streams/abc requestId:FALLBACK-TRUTH-MISSING status:503 title:Control Plane Unavailable type:streams/unavailable]
=== RUN   TestContract_StopStream_DeleteStreamsId/16_ControlPlaneDisabled_NoBus
    contract_v3_streams_stop_test.go:122: Response: Status=503 Body=map[code:UNAVAILABLE detail:V3 control plane is not enabled instance:/api/v3/streams/abc requestId:FALLBACK-TRUTH-MISSING status:503 title:Control Plane Unavailable type:streams/unavailable]
=== RUN   TestContract_StopStream_DeleteStreamsId/17_SessionNotFound
    contract_v3_streams_stop_test.go:136: Response: Status=404 Body=map[code:NOT_FOUND detail:The session does not exist instance:/api/v3/streams/abc requestId:FALLBACK-TRUTH-MISSING status:404 title:Session Not Found type:streams/not_found]
=== RUN   TestContract_StopStream_DeleteStreamsId/18_StoreError
    contract_v3_streams_stop_test.go:150: Response: Status=500 Body=map[code:STOP_FAILED detail:Failed to retrieve session state instance:/api/v3/streams/abc requestId:FALLBACK-TRUTH-MISSING status:500 title:Stop Failed type:streams/stop_failed]
=== RUN   TestContract_StopStream_DeleteStreamsId/19_PublishFails
    contract_v3_streams_stop_test.go:167: Response: Status=500 Body=map[code:STOP_FAILED detail:Failed to publish stop event instance:/api/v3/streams/abc requestId:FALLBACK-TRUTH-MISSING status:500 title:Stop Failed type:streams/stop_failed]
=== RUN   TestContract_StopStream_DeleteStreamsId/20_Success_204_PublishesCorrectEvent
--- PASS: TestContract_StopStream_DeleteStreamsId (0.00s)
    --- PASS: TestContract_StopStream_DeleteStreamsId/13_InvalidID_Empty (0.00s)
    --- PASS: TestContract_StopStream_DeleteStreamsId/14_InvalidID_Unsafe (0.00s)
    --- PASS: TestContract_StopStream_DeleteStreamsId/15_ControlPlaneDisabled_NoStore (0.00s)
    --- PASS: TestContract_StopStream_DeleteStreamsId/16_ControlPlaneDisabled_NoBus (0.00s)
    --- PASS: TestContract_StopStream_DeleteStreamsId/17_SessionNotFound (0.00s)
    --- PASS: TestContract_StopStream_DeleteStreamsId/18_StoreError (0.00s)
    --- PASS: TestContract_StopStream_DeleteStreamsId/19_PublishFails (0.00s)
    --- PASS: TestContract_StopStream_DeleteStreamsId/20_Success_204_PublishesCorrectEvent (0.00s)
=== RUN   TestGetStreams_Contract_Slice53
=== RUN   TestGetStreams_Contract_Slice53/Empty_Returns_EmptyList
=== RUN   TestGetStreams_Contract_Slice53/PlaylistFilename_Empty_BestEffort
=== RUN   TestGetStreams_Contract_Slice53/Sorting_Deterministic
=== RUN   TestGetStreams_Contract_Slice53/IP_Gating
=== RUN   TestGetStreams_Contract_Slice53/Terminal_States_Filtered
=== RUN   TestGetStreams_Contract_Slice53/Error_Contract_ProblemDetails
=== RUN   TestGetStreams_Contract_Slice53/Error_Contract_ProblemDetails/StoreNil
{"level":"error","service":"xg2g","version":"","time":"2026-02-01T14:41:26+01:00","message":"v3 store not initialized"}
=== RUN   TestGetStreams_Contract_Slice53/Error_Contract_ProblemDetails/StoreError
{"level":"error","service":"xg2g","version":"","error":"db boom","time":"2026-02-01T14:41:26+01:00","message":"failed to get streams"}
=== RUN   TestGetStreams_Contract_Slice53/Mandatory_Traceability_Fields
=== RUN   TestGetStreams_Contract_Slice53/Lifecycle_Truth_Mapping
--- PASS: TestGetStreams_Contract_Slice53 (0.00s)
    --- PASS: TestGetStreams_Contract_Slice53/Empty_Returns_EmptyList (0.00s)
    --- PASS: TestGetStreams_Contract_Slice53/PlaylistFilename_Empty_BestEffort (0.00s)
    --- PASS: TestGetStreams_Contract_Slice53/Sorting_Deterministic (0.00s)
    --- PASS: TestGetStreams_Contract_Slice53/IP_Gating (0.00s)
    --- PASS: TestGetStreams_Contract_Slice53/Terminal_States_Filtered (0.00s)
    --- PASS: TestGetStreams_Contract_Slice53/Error_Contract_ProblemDetails (0.00s)
        --- PASS: TestGetStreams_Contract_Slice53/Error_Contract_ProblemDetails/StoreNil (0.00s)
        --- PASS: TestGetStreams_Contract_Slice53/Error_Contract_ProblemDetails/StoreError (0.00s)
    --- PASS: TestGetStreams_Contract_Slice53/Mandatory_Traceability_Fields (0.00s)
    --- PASS: TestGetStreams_Contract_Slice53/Lifecycle_Truth_Mapping (0.00s)
=== RUN   TestContract_SystemRefresh
=== RUN   TestContract_SystemRefresh/21_RefreshUnavailable_NoScanner
    contract_v3_system_refresh_test.go:46: Response: Status=503 Body=map[code:UNAVAILABLE detail:Scanner not enabled instance:/api/v3/system/refresh requestId:FALLBACK-TRUTH-MISSING status:503 title:Subsystem Unavailable type:system/unavailable]
=== RUN   TestContract_SystemRefresh/22_RefreshAccepted_TriggersBackground
{"level":"info","service":"xg2g","version":"","duration":0.008546,"time":"2026-02-01T14:41:26+01:00","message":"manual refresh triggered via API"}
--- PASS: TestContract_SystemRefresh (0.00s)
    --- PASS: TestContract_SystemRefresh/21_RefreshUnavailable_NoScanner (0.00s)
    --- PASS: TestContract_SystemRefresh/22_RefreshAccepted_TriggersBackground (0.00s)
=== RUN   TestV3Contract_Intents
{"level":"info","service":"xg2g","version":"","component":"api","correlationId":"corr-intent-001","ua":"","profile":"high","dvr_window_sec":0,"idem_key":"ac5cc60bc97456f7ea6a06be0de9f8addfc7d8b08a863777a71329be54c725ea","gpu_available":true,"hwaccel_requested":"auto","hwaccel_effective":"off","hwaccel_reason":"passthrough","encoder_backend":"none","video_codec":"","container":"","llhls":false,"time":"2026-02-01T14:41:26+01:00","message":"intent profile resolved"}
{"level":"info","service":"xg2g","version":"","component":"api","correlationId":"corr-intent-001","time":"2026-02-01T14:41:26+01:00","message":"intent accepted"}
--- PASS: TestV3Contract_Intents (0.13s)
=== RUN   TestV3Contract_Intents_AdmissionRejected
{"level":"error","service":"xg2g","version":"","error":"context deadline exceeded","time":"2026-02-01T14:41:26+01:00","message":"admission state snapshot failed, failing closed"}
{"level":"info","service":"xg2g","version":"","serviceRef":"1:0:1:445D:453:1:C00000:0:0:0:","code":"ADMISSION_STATE_UNKNOWN","time":"2026-02-01T14:41:26+01:00","message":"admission rejected"}
--- PASS: TestV3Contract_Intents_AdmissionRejected (0.00s)
=== RUN   TestV3Contract_IntentLeaseBusy
=== RUN   TestV3Contract_IntentLeaseBusy/phase2_idempotent_replay
{"level":"info","service":"xg2g","version":"","component":"api","correlationId":"corr-intent-001","ua":"","profile":"high","dvr_window_sec":0,"idem_key":"ac5cc60bc97456f7ea6a06be0de9f8addfc7d8b08a863777a71329be54c725ea","gpu_available":true,"hwaccel_requested":"auto","hwaccel_effective":"off","hwaccel_reason":"passthrough","encoder_backend":"none","video_codec":"","container":"","llhls":false,"time":"2026-02-01T14:41:26+01:00","message":"intent profile resolved"}
{"level":"info","service":"xg2g","version":"","component":"api","correlationId":"corr-intent-001","time":"2026-02-01T14:41:26+01:00","message":"intent accepted"}
{"level":"info","service":"xg2g","version":"","component":"api","correlationId":"corr-intent-001","ua":"","profile":"high","dvr_window_sec":0,"idem_key":"ac5cc60bc97456f7ea6a06be0de9f8addfc7d8b08a863777a71329be54c725ea","gpu_available":true,"hwaccel_requested":"auto","hwaccel_effective":"off","hwaccel_reason":"passthrough","encoder_backend":"none","video_codec":"","container":"","llhls":false,"time":"2026-02-01T14:41:26+01:00","message":"intent profile resolved"}
{"level":"info","service":"xg2g","version":"","component":"api","correlationId":"corr-intent-001","existing_sid":"67c00aba-ed58-4af8-aad0-e9d503f23c36","time":"2026-02-01T14:41:26+01:00","message":"idempotent replay detected"}
--- PASS: TestV3Contract_IntentLeaseBusy (0.06s)
    --- PASS: TestV3Contract_IntentLeaseBusy/phase2_idempotent_replay (0.06s)
=== RUN   TestV3Contract_SessionState
--- PASS: TestV3Contract_SessionState (0.00s)
=== RUN   TestV3Contract_SessionState_TerminalOutcomeMatrix
=== RUN   TestV3Contract_SessionState_TerminalOutcomeMatrix/cancelled_context
=== RUN   TestV3Contract_SessionState_TerminalOutcomeMatrix/stopped_strips_cancel_detail
{"level":"warn","service":"xg2g","version":"","sessionId":"550e8400-e29b-41d4-a716-446655440000","time":"2026-02-01T14:41:26+01:00","message":"corrected stopped detail_code"}
=== RUN   TestV3Contract_SessionState_TerminalOutcomeMatrix/failed_tune_timeout
--- PASS: TestV3Contract_SessionState_TerminalOutcomeMatrix (0.00s)
    --- PASS: TestV3Contract_SessionState_TerminalOutcomeMatrix/cancelled_context (0.00s)
    --- PASS: TestV3Contract_SessionState_TerminalOutcomeMatrix/stopped_strips_cancel_detail (0.00s)
    --- PASS: TestV3Contract_SessionState_TerminalOutcomeMatrix/failed_tune_timeout (0.00s)
=== RUN   TestV3Contract_ReadyImpliesPlayable
--- PASS: TestV3Contract_ReadyImpliesPlayable (0.00s)
=== RUN   TestV3Contract_HLS
--- PASS: TestV3Contract_HLS (0.01s)
=== RUN   TestV3Contract_HLSRange
--- PASS: TestV3Contract_HLSRange (0.00s)
=== RUN   TestTraceability_RecordingsList
--- PASS: TestTraceability_RecordingsList (0.00s)
=== RUN   TestTraceability_GetSession_Real
--- PASS: TestTraceability_GetSession_Real (0.00s)
=== RUN   TestTraceability_GetStreams
--- PASS: TestTraceability_GetStreams (0.00s)
=== RUN   TestTraceability_RFC7807_Error
{"level":"error","service":"xg2g","version":"","error":"simulated error","time":"2026-02-01T14:41:26+01:00","message":"recordings service error"}
--- PASS: TestTraceability_RFC7807_Error (0.00s)
=== RUN   TestContract_Global_ProblemDetails
=== RUN   TestContract_Global_ProblemDetails/1_InvalidJSON_AddTimer
    contract_v3_write_test.go:94: Response: Status=400 Body=map[code:INVALID_INPUT detail:The request body is malformed or empty instance:/api/v3/dvr/timers requestId:FALLBACK-TRUTH-MISSING status:400 title:Invalid Request Body type:dvr/invalid_input]
=== RUN   TestContract_Global_ProblemDetails/2_InvalidJSON_UpdateTimer
    contract_v3_write_test.go:102: Response: Status=400 Body=map[code:INVALID_INPUT detail:The request body is malformed or empty instance:/api/v3/dvr/timers/123 requestId:FALLBACK-TRUTH-MISSING status:400 title:Invalid Request Body type:dvr/invalid_input]
=== RUN   TestContract_Global_ProblemDetails/3_InvalidBody_PreviewConflicts
    contract_v3_write_test.go:110: Response: Status=400 Body=map[code:INVALID_INPUT detail:The request body is malformed or empty instance:/api/v3/dvr/timers/conflicts/preview requestId:FALLBACK-TRUTH-MISSING status:400 title:Invalid Request Body type:dvr/invalid_input]
=== RUN   TestContract_Global_ProblemDetails/4_InvalidID_DeleteStreams
    contract_v3_write_test.go:121: Server type: *v3.Server
    contract_v3_write_test.go:122: isSafe=false
    contract_v3_write_test.go:127: status=400 ct="application/problem+json"
    contract_v3_write_test.go:129: Response: Status=400 Body=map[code:INVALID_SESSION_ID detail:The provided session ID contains unsafe characters instance:/api/v3/streams/../unsafe requestId:FALLBACK-TRUTH-MISSING status:400 title:Invalid Session ID type:streams/invalid_id]
=== RUN   TestContract_Global_ProblemDetails/5_InvalidTimerID_DeleteTimer
    contract_v3_write_test.go:137: Response: Status=400 Body=map[code:INVALID_ID detail:The provided timer ID is invalid instance:/api/v3/dvr/timers/bad-id requestId:FALLBACK-TRUTH-MISSING status:400 title:Invalid Timer ID type:dvr/invalid_id]
=== RUN   TestContract_Global_ProblemDetails/6_InvalidTimerID_UpdateTimer
    contract_v3_write_test.go:145: Response: Status=400 Body=map[code:INVALID_ID detail:The provided timer ID is invalid instance:/api/v3/dvr/timers/bad-id requestId:FALLBACK-TRUTH-MISSING status:400 title:Invalid Timer ID type:dvr/invalid_id]
=== RUN   TestContract_Global_ProblemDetails/7_ControlPlaneDisabled_DeleteStreams
    contract_v3_write_test.go:154: Response: Status=503 Body=map[code:UNAVAILABLE detail:V3 control plane is not enabled instance:/api/v3/streams/123 requestId:FALLBACK-TRUTH-MISSING status:503 title:Control Plane Unavailable type:streams/unavailable]
=== RUN   TestContract_Global_ProblemDetails/8_ControlPlaneDisabled_GetStreams
{"level":"error","service":"xg2g","version":"","time":"2026-02-01T14:41:26+01:00","message":"v3 store not initialized"}
    contract_v3_write_test.go:163: Response: Status=503 Body=map[code:UNAVAILABLE detail:The V3 control plane is not enabled instance:/api/v3/streams requestId:FALLBACK-TRUTH-MISSING status:503 title:V3 control plane not enabled type:streams/unavailable]
=== RUN   TestContract_Global_ProblemDetails/12b_ProblemDetails_OmitsDetails_WhenNil
{"level":"error","service":"xg2g","version":"","time":"2026-02-01T14:41:26+01:00","message":"v3 store not initialized"}
--- PASS: TestContract_Global_ProblemDetails (0.00s)
    --- PASS: TestContract_Global_ProblemDetails/1_InvalidJSON_AddTimer (0.00s)
    --- PASS: TestContract_Global_ProblemDetails/2_InvalidJSON_UpdateTimer (0.00s)
    --- PASS: TestContract_Global_ProblemDetails/3_InvalidBody_PreviewConflicts (0.00s)
    --- PASS: TestContract_Global_ProblemDetails/4_InvalidID_DeleteStreams (0.00s)
    --- PASS: TestContract_Global_ProblemDetails/5_InvalidTimerID_DeleteTimer (0.00s)
    --- PASS: TestContract_Global_ProblemDetails/6_InvalidTimerID_UpdateTimer (0.00s)
    --- PASS: TestContract_Global_ProblemDetails/7_ControlPlaneDisabled_DeleteStreams (0.00s)
    --- PASS: TestContract_Global_ProblemDetails/8_ControlPlaneDisabled_GetStreams (0.00s)
    --- PASS: TestContract_Global_ProblemDetails/12b_ProblemDetails_OmitsDetails_WhenNil (0.00s)
=== RUN   TestHealthEquivalence_Hardened
--- PASS: TestHealthEquivalence_Hardened (0.00s)
=== RUN   TestConfigEquivalence_Hardened
--- PASS: TestConfigEquivalence_Hardened (0.00s)
=== RUN   TestConfigRedaction_Hardened
--- PASS: TestConfigRedaction_Hardened (0.00s)
=== RUN   TestHealthVsHealthzDivergence_Hardened
--- PASS: TestHealthVsHealthzDivergence_Hardened (0.00s)
=== RUN   TestSlice5_1_Equivalence
=== RUN   TestSlice5_1_Equivalence/Scan_Status
=== RUN   TestSlice5_1_Equivalence/DVR_Capabilities
=== RUN   TestSlice5_1_Equivalence/DVR_Status
=== RUN   TestSlice5_1_Equivalence/Services_Bouquets
--- PASS: TestSlice5_1_Equivalence (0.00s)
    --- PASS: TestSlice5_1_Equivalence/Scan_Status (0.00s)
    --- PASS: TestSlice5_1_Equivalence/DVR_Capabilities (0.00s)
    --- PASS: TestSlice5_1_Equivalence/DVR_Status (0.00s)
    --- PASS: TestSlice5_1_Equivalence/Services_Bouquets (0.00s)
=== RUN   TestSlice5_2_Equivalence
=== RUN   TestSlice5_2_Equivalence/GetServices/Combinatorial
=== RUN   TestSlice5_2_Equivalence/GetServices/Combinatorial/All_Services
=== RUN   TestSlice5_2_Equivalence/GetServices/Combinatorial/Favorites_Only
=== RUN   TestSlice5_2_Equivalence/GetServices/Combinatorial/Movies_Only
=== RUN   TestSlice5_2_Equivalence/GetServices/Combinatorial/Non_Existent
=== RUN   TestSlice5_2_Equivalence/GetTimers/All
=== RUN   TestSlice5_2_Equivalence/GetServices/Playlist_Missing
DEBUG: GetServices ReadFile failed: /tmp/TestSlice5_2_Equivalence2846778368/001/test.m3u, err=open /tmp/TestSlice5_2_Equivalence2846778368/001/test.m3u: no such file or directory
=== RUN   TestSlice5_2_Equivalence/GetServices/Playlist_Empty
=== RUN   TestSlice5_2_Equivalence/GetServices/PlaylistFilename_Missing
DEBUG: GetServices ReadFile failed: /tmp/TestSlice5_2_Equivalence2846778368/001/missing.m3u, err=open /tmp/TestSlice5_2_Equivalence2846778368/001/missing.m3u: no such file or directory
=== RUN   TestSlice5_2_Equivalence/GetServicesBouquets/Empty
=== RUN   TestSlice5_2_Equivalence/GetServicesBouquets/PlaylistFilename_Missing_ConfigBouquetEmpty
=== RUN   TestSlice5_2_Equivalence/GetEpg/Combinatorial
=== RUN   TestSlice5_2_Equivalence/GetEpg/Combinatorial/All_Events_Wide_Window
=== RUN   TestSlice5_2_Equivalence/GetEpg/Combinatorial/Restricted_Window_First_Event
=== RUN   TestSlice5_2_Equivalence/GetEpg/Combinatorial/Bouquet_Filter_Favorites_Only_id1
=== RUN   TestSlice5_2_Equivalence/GetEpg/Combinatorial/Bouquet_Filter_Playlist_Missing
=== RUN   TestSlice5_2_Equivalence/GetEpg/Combinatorial/Search_Query_News
=== RUN   TestSlice5_2_Equivalence/GetEpg/Combinatorial/Search_Query_NoMatch
=== RUN   TestSlice5_2_Equivalence/GetEpg/Bouquet_Filter_Failure
=== RUN   TestSlice5_2_Equivalence/GetEpg/Bouquet_Filter_Failure/Playlist_Missing_With_Bouquet
=== RUN   TestSlice5_2_Equivalence/GetEpg/Bouquet_Filter_Failure/Playlist_Missing_With_Bouquet_And_Search
--- PASS: TestSlice5_2_Equivalence (0.00s)
    --- PASS: TestSlice5_2_Equivalence/GetServices/Combinatorial (0.00s)
        --- PASS: TestSlice5_2_Equivalence/GetServices/Combinatorial/All_Services (0.00s)
        --- PASS: TestSlice5_2_Equivalence/GetServices/Combinatorial/Favorites_Only (0.00s)
        --- PASS: TestSlice5_2_Equivalence/GetServices/Combinatorial/Movies_Only (0.00s)
        --- PASS: TestSlice5_2_Equivalence/GetServices/Combinatorial/Non_Existent (0.00s)
    --- PASS: TestSlice5_2_Equivalence/GetTimers/All (0.00s)
    --- PASS: TestSlice5_2_Equivalence/GetServices/Playlist_Missing (0.00s)
    --- PASS: TestSlice5_2_Equivalence/GetServices/Playlist_Empty (0.00s)
    --- PASS: TestSlice5_2_Equivalence/GetServices/PlaylistFilename_Missing (0.00s)
    --- PASS: TestSlice5_2_Equivalence/GetServicesBouquets/Empty (0.00s)
    --- PASS: TestSlice5_2_Equivalence/GetServicesBouquets/PlaylistFilename_Missing_ConfigBouquetEmpty (0.00s)
    --- PASS: TestSlice5_2_Equivalence/GetEpg/Combinatorial (0.00s)
        --- PASS: TestSlice5_2_Equivalence/GetEpg/Combinatorial/All_Events_Wide_Window (0.00s)
        --- PASS: TestSlice5_2_Equivalence/GetEpg/Combinatorial/Restricted_Window_First_Event (0.00s)
        --- PASS: TestSlice5_2_Equivalence/GetEpg/Combinatorial/Bouquet_Filter_Favorites_Only_id1 (0.00s)
        --- PASS: TestSlice5_2_Equivalence/GetEpg/Combinatorial/Bouquet_Filter_Playlist_Missing (0.00s)
        --- PASS: TestSlice5_2_Equivalence/GetEpg/Combinatorial/Search_Query_News (0.00s)
        --- PASS: TestSlice5_2_Equivalence/GetEpg/Combinatorial/Search_Query_NoMatch (0.00s)
    --- PASS: TestSlice5_2_Equivalence/GetEpg/Bouquet_Filter_Failure (0.00s)
        --- PASS: TestSlice5_2_Equivalence/GetEpg/Bouquet_Filter_Failure/Playlist_Missing_With_Bouquet (0.00s)
        --- PASS: TestSlice5_2_Equivalence/GetEpg/Bouquet_Filter_Failure/Playlist_Missing_With_Bouquet_And_Search (0.00s)
=== RUN   TestWriteJSON
=== RUN   TestWriteJSON/simple_map
=== RUN   TestWriteJSON/complex_struct
--- PASS: TestWriteJSON (0.00s)
    --- PASS: TestWriteJSON/simple_map (0.00s)
    --- PASS: TestWriteJSON/complex_struct (0.00s)
=== RUN   TestClientPlaybackInfo_StrictFailClosed
=== RUN   TestClientPlaybackInfo_StrictFailClosed/UnknownCodecs_=>_Transcode
{"level":"info","service":"xg2g","version":"","event":"client.playback_decision","id":"rec1","decision":"transcode","strategy":"direct","time":"2026-02-01T14:41:26+01:00","message":"resolved client playback"}
=== RUN   TestClientPlaybackInfo_StrictFailClosed/Known+Supported_=>_DirectPlay
{"level":"info","service":"xg2g","version":"","event":"client.playback_decision","id":"rec1","decision":"direct_play","strategy":"direct","container":"mp4","time":"2026-02-01T14:41:26+01:00","message":"resolved client playback"}
=== RUN   TestClientPlaybackInfo_StrictFailClosed/Known+Unsupported_=>_Transcode
{"level":"info","service":"xg2g","version":"","event":"client.playback_decision","id":"rec1","decision":"transcode","strategy":"direct","container":"mp4","time":"2026-02-01T14:41:26+01:00","message":"resolved client playback"}
=== RUN   TestClientPlaybackInfo_StrictFailClosed/DriftGuard_JsonKeys
{"level":"info","service":"xg2g","version":"","event":"client.playback_decision","id":"rec1","decision":"transcode","strategy":"direct","time":"2026-02-01T14:41:26+01:00","message":"resolved client playback"}
--- PASS: TestClientPlaybackInfo_StrictFailClosed (0.00s)
    --- PASS: TestClientPlaybackInfo_StrictFailClosed/UnknownCodecs_=>_Transcode (0.00s)
    --- PASS: TestClientPlaybackInfo_StrictFailClosed/Known+Supported_=>_DirectPlay (0.00s)
    --- PASS: TestClientPlaybackInfo_StrictFailClosed/Known+Unsupported_=>_Transcode (0.00s)
    --- PASS: TestClientPlaybackInfo_StrictFailClosed/DriftGuard_JsonKeys (0.00s)
=== RUN   TestGetEpg_ResponseShape
--- PASS: TestGetEpg_ResponseShape (0.00s)
=== RUN   TestHLS_ProfilePropagation
=== RUN   TestHLS_ProfilePropagation/Safari_Mac
=== RUN   TestHLS_ProfilePropagation/Generic_Chrome
--- PASS: TestHLS_ProfilePropagation (0.00s)
    --- PASS: TestHLS_ProfilePropagation/Safari_Mac (0.00s)
    --- PASS: TestHLS_ProfilePropagation/Generic_Chrome (0.00s)
=== RUN   TestHLSHandlers_Matrix
=== RUN   TestHLSHandlers_Matrix/Playlist_200_GET
=== RUN   TestHLSHandlers_Matrix/Playlist_200_HEAD
=== RUN   TestHLSHandlers_Matrix/Playlist_416_RangeViolation
=== RUN   TestHLSHandlers_Matrix/Playlist_503_Preparing
=== RUN   TestHLSHandlers_Matrix/Segment_200_GET
=== RUN   TestHLSHandlers_Matrix/Segment_206_Range
=== RUN   TestHLSHandlers_Matrix/Segment_416_InvalidRange
--- PASS: TestHLSHandlers_Matrix (0.00s)
    --- PASS: TestHLSHandlers_Matrix/Playlist_200_GET (0.00s)
    --- PASS: TestHLSHandlers_Matrix/Playlist_200_HEAD (0.00s)
    --- PASS: TestHLSHandlers_Matrix/Playlist_416_RangeViolation (0.00s)
    --- PASS: TestHLSHandlers_Matrix/Playlist_503_Preparing (0.00s)
    --- PASS: TestHLSHandlers_Matrix/Segment_200_GET (0.00s)
    --- PASS: TestHLSHandlers_Matrix/Segment_206_Range (0.00s)
    --- PASS: TestHLSHandlers_Matrix/Segment_416_InvalidRange (0.00s)
=== RUN   TestIntentsPreflight_ProblemMapping
=== RUN   TestIntentsPreflight_ProblemMapping/unreachable
{"level":"info","service":"xg2g","version":"","component":"openwebif","host":"example.invalid","rate_limit_rps":10,"burst":20,"time":"2026-02-01T14:41:26+01:00","message":"receiver rate limiting enabled"}
{"level":"warn","service":"xg2g","version":"","component":"api","request_id":"req-preflight-001","outcome":"unreachable","status":502,"time":"2026-02-01T14:41:26+01:00","message":"preflight rejected"}
=== RUN   TestIntentsPreflight_ProblemMapping/timeout
{"level":"info","service":"xg2g","version":"","component":"openwebif","host":"example.invalid","rate_limit_rps":10,"burst":20,"time":"2026-02-01T14:41:26+01:00","message":"receiver rate limiting enabled"}
{"level":"warn","service":"xg2g","version":"","component":"api","request_id":"req-preflight-001","outcome":"timeout","status":504,"time":"2026-02-01T14:41:26+01:00","message":"preflight rejected"}
=== RUN   TestIntentsPreflight_ProblemMapping/unauthorized
{"level":"info","service":"xg2g","version":"","component":"openwebif","host":"example.invalid","rate_limit_rps":10,"burst":20,"time":"2026-02-01T14:41:26+01:00","message":"receiver rate limiting enabled"}
{"level":"warn","service":"xg2g","version":"","component":"api","request_id":"req-preflight-001","outcome":"unauthorized","status":401,"time":"2026-02-01T14:41:26+01:00","message":"preflight rejected"}
=== RUN   TestIntentsPreflight_ProblemMapping/forbidden
{"level":"info","service":"xg2g","version":"","component":"openwebif","host":"example.invalid","rate_limit_rps":10,"burst":20,"time":"2026-02-01T14:41:26+01:00","message":"receiver rate limiting enabled"}
{"level":"warn","service":"xg2g","version":"","component":"api","request_id":"req-preflight-001","outcome":"forbidden","status":403,"time":"2026-02-01T14:41:26+01:00","message":"preflight rejected"}
=== RUN   TestIntentsPreflight_ProblemMapping/not_found
{"level":"info","service":"xg2g","version":"","component":"openwebif","host":"example.invalid","rate_limit_rps":10,"burst":20,"time":"2026-02-01T14:41:26+01:00","message":"receiver rate limiting enabled"}
{"level":"warn","service":"xg2g","version":"","component":"api","request_id":"req-preflight-001","outcome":"not_found","status":404,"time":"2026-02-01T14:41:26+01:00","message":"preflight rejected"}
=== RUN   TestIntentsPreflight_ProblemMapping/bad_gateway
{"level":"info","service":"xg2g","version":"","component":"openwebif","host":"example.invalid","rate_limit_rps":10,"burst":20,"time":"2026-02-01T14:41:26+01:00","message":"receiver rate limiting enabled"}
{"level":"warn","service":"xg2g","version":"","component":"api","request_id":"req-preflight-001","outcome":"bad_gateway","status":502,"time":"2026-02-01T14:41:26+01:00","message":"preflight rejected"}
=== RUN   TestIntentsPreflight_ProblemMapping/internal
{"level":"info","service":"xg2g","version":"","component":"openwebif","host":"example.invalid","rate_limit_rps":10,"burst":20,"time":"2026-02-01T14:41:26+01:00","message":"receiver rate limiting enabled"}
{"level":"error","service":"xg2g","version":"","component":"api","request_id":"req-preflight-001","outcome":"internal","status":500,"time":"2026-02-01T14:41:26+01:00","message":"preflight failed"}
--- PASS: TestIntentsPreflight_ProblemMapping (0.00s)
    --- PASS: TestIntentsPreflight_ProblemMapping/unreachable (0.00s)
    --- PASS: TestIntentsPreflight_ProblemMapping/timeout (0.00s)
    --- PASS: TestIntentsPreflight_ProblemMapping/unauthorized (0.00s)
    --- PASS: TestIntentsPreflight_ProblemMapping/forbidden (0.00s)
    --- PASS: TestIntentsPreflight_ProblemMapping/not_found (0.00s)
    --- PASS: TestIntentsPreflight_ProblemMapping/bad_gateway (0.00s)
    --- PASS: TestIntentsPreflight_ProblemMapping/internal (0.00s)
=== RUN   TestIntentsPreflight_NoBestEffort
{"level":"info","service":"xg2g","version":"","component":"openwebif","host":"example.invalid","rate_limit_rps":10,"burst":20,"time":"2026-02-01T14:41:26+01:00","message":"receiver rate limiting enabled"}
{"level":"warn","service":"xg2g","version":"","component":"api","request_id":"req-preflight-001","outcome":"unreachable","status":502,"time":"2026-02-01T14:41:26+01:00","message":"preflight rejected"}
--- PASS: TestIntentsPreflight_NoBestEffort (0.00s)
=== RUN   TestIntentsPreflight_Metrics
{"level":"info","service":"xg2g","version":"","component":"openwebif","host":"example.invalid","rate_limit_rps":10,"burst":20,"time":"2026-02-01T14:41:26+01:00","message":"receiver rate limiting enabled"}
{"level":"warn","service":"xg2g","version":"","component":"api","request_id":"req-preflight-001","outcome":"unreachable","status":502,"time":"2026-02-01T14:41:26+01:00","message":"preflight rejected"}
--- PASS: TestIntentsPreflight_Metrics (0.00s)
=== RUN   TestIntentsPreflight_DetailNoSecrets
{"level":"info","service":"xg2g","version":"","component":"openwebif","host":"example.invalid","rate_limit_rps":10,"burst":20,"time":"2026-02-01T14:41:26+01:00","message":"receiver rate limiting enabled"}
{"level":"warn","service":"xg2g","version":"","component":"api","request_id":"req-preflight-001","outcome":"unauthorized","status":401,"time":"2026-02-01T14:41:26+01:00","message":"preflight rejected"}
--- PASS: TestIntentsPreflight_DetailNoSecrets (0.00s)
=== RUN   TestGetRecordingPlaybackInfo_P3_4_SegmentTruth
=== RUN   TestGetRecordingPlaybackInfo_P3_4_SegmentTruth/Traceability_Propagation
=== RUN   TestGetRecordingPlaybackInfo_P3_4_SegmentTruth/Live_FailClosed_ImplausibleWindow
=== RUN   TestGetRecordingPlaybackInfo_P3_4_SegmentTruth/Live_FailClosed_PartialPDT
=== RUN   TestGetRecordingPlaybackInfo_P3_4_SegmentTruth/VOD_Robust_NoPDT
=== RUN   TestGetRecordingPlaybackInfo_P3_4_SegmentTruth/Live_Valid_FullTruth
--- PASS: TestGetRecordingPlaybackInfo_P3_4_SegmentTruth (0.00s)
    --- PASS: TestGetRecordingPlaybackInfo_P3_4_SegmentTruth/Traceability_Propagation (0.00s)
    --- PASS: TestGetRecordingPlaybackInfo_P3_4_SegmentTruth/Live_FailClosed_ImplausibleWindow (0.00s)
    --- PASS: TestGetRecordingPlaybackInfo_P3_4_SegmentTruth/Live_FailClosed_PartialPDT (0.00s)
    --- PASS: TestGetRecordingPlaybackInfo_P3_4_SegmentTruth/VOD_Robust_NoPDT (0.00s)
    --- PASS: TestGetRecordingPlaybackInfo_P3_4_SegmentTruth/Live_Valid_FullTruth (0.00s)
=== RUN   TestGetRecordingPlaybackInfo_StrictTruthfulness
=== RUN   TestGetRecordingPlaybackInfo_StrictTruthfulness/NotFound
=== RUN   TestGetRecordingPlaybackInfo_StrictTruthfulness/Preparing
=== RUN   TestGetRecordingPlaybackInfo_StrictTruthfulness/InvalidArgument
=== RUN   TestGetRecordingPlaybackInfo_StrictTruthfulness/UpstreamError
=== RUN   TestGetRecordingPlaybackInfo_StrictTruthfulness/DTO_Mapping_UnknownDuration_UnknownCodecs
=== RUN   TestGetRecordingPlaybackInfo_StrictTruthfulness/DTO_Mapping_KnownDuration_KnownCodecs
--- PASS: TestGetRecordingPlaybackInfo_StrictTruthfulness (0.00s)
    --- PASS: TestGetRecordingPlaybackInfo_StrictTruthfulness/NotFound (0.00s)
    --- PASS: TestGetRecordingPlaybackInfo_StrictTruthfulness/Preparing (0.00s)
    --- PASS: TestGetRecordingPlaybackInfo_StrictTruthfulness/InvalidArgument (0.00s)
    --- PASS: TestGetRecordingPlaybackInfo_StrictTruthfulness/UpstreamError (0.00s)
    --- PASS: TestGetRecordingPlaybackInfo_StrictTruthfulness/DTO_Mapping_UnknownDuration_UnknownCodecs (0.00s)
    --- PASS: TestGetRecordingPlaybackInfo_StrictTruthfulness/DTO_Mapping_KnownDuration_KnownCodecs (0.00s)
=== RUN   TestGetRecordingPlaybackInfo_ID_Ownership_StrictHexRequirement
--- PASS: TestGetRecordingPlaybackInfo_ID_Ownership_StrictHexRequirement (0.00s)
=== RUN   TestGetRecordingPlaybackInfo_Deny_OptionB
--- PASS: TestGetRecordingPlaybackInfo_Deny_OptionB (0.00s)
=== RUN   TestGetServicesBouquets_ResponseShapeAndCounts
--- PASS: TestGetServicesBouquets_ResponseShapeAndCounts (0.00s)
=== RUN   TestGetServicesBouquets_Fallback
--- PASS: TestGetServicesBouquets_Fallback (0.00s)
=== RUN   TestGetServicesBouquets_EmptyFile
--- PASS: TestGetServicesBouquets_EmptyFile (0.00s)
=== RUN   TestGetServicesBouquets_FailClosed
{"level":"error","service":"xg2g","version":"","error":"read /tmp/TestGetServicesBouquets_FailClosed3879313759/001/bad.m3u: is a directory","cause":"read","time":"2026-02-01T14:41:26+01:00","message":"failed to get bouquets"}
--- PASS: TestGetServicesBouquets_FailClosed (0.00s)
=== RUN   TestStreamRecordingDirect_RangeMatrix
=== RUN   TestStreamRecordingDirect_RangeMatrix/Full_GET
=== RUN   TestStreamRecordingDirect_RangeMatrix/Partial_FirstByte
=== RUN   TestStreamRecordingDirect_RangeMatrix/Partial_First100
=== RUN   TestStreamRecordingDirect_RangeMatrix/Partial_Suffix
=== RUN   TestStreamRecordingDirect_RangeMatrix/Partial_OpenEnded
=== RUN   TestStreamRecordingDirect_RangeMatrix/Invalid_OutOfRange
=== RUN   TestStreamRecordingDirect_RangeMatrix/Invalid_MultiRange_PolicyA
=== RUN   TestStreamRecordingDirect_RangeMatrix/Full_HEAD
=== RUN   TestStreamRecordingDirect_RangeMatrix/Partial_HEAD
--- PASS: TestStreamRecordingDirect_RangeMatrix (0.00s)
    --- PASS: TestStreamRecordingDirect_RangeMatrix/Full_GET (0.00s)
    --- PASS: TestStreamRecordingDirect_RangeMatrix/Partial_FirstByte (0.00s)
    --- PASS: TestStreamRecordingDirect_RangeMatrix/Partial_First100 (0.00s)
    --- PASS: TestStreamRecordingDirect_RangeMatrix/Partial_Suffix (0.00s)
    --- PASS: TestStreamRecordingDirect_RangeMatrix/Partial_OpenEnded (0.00s)
    --- PASS: TestStreamRecordingDirect_RangeMatrix/Invalid_OutOfRange (0.00s)
    --- PASS: TestStreamRecordingDirect_RangeMatrix/Invalid_MultiRange_PolicyA (0.00s)
    --- PASS: TestStreamRecordingDirect_RangeMatrix/Full_HEAD (0.00s)
    --- PASS: TestStreamRecordingDirect_RangeMatrix/Partial_HEAD (0.00s)
=== RUN   TestHotReload_LogLevel_Hardened
    hot_reload_test.go:133: expected 400 Bad Request for invalid level, got 200
--- FAIL: TestHotReload_LogLevel_Hardened (0.00s)
=== RUN   TestHotReload_AuditGating_Killer
--- PASS: TestHotReload_AuditGating_Killer (0.00s)
=== RUN   TestHotReload_SliceNormalization_Hardened
--- PASS: TestHotReload_SliceNormalization_Hardened (0.00s)
=== RUN   TestHotReload_EmptyBouquets_CSVNormalization
--- PASS: TestHotReload_EmptyBouquets_CSVNormalization (0.00s)
=== RUN   TestHotReload_ConcurrencyStress
--- PASS: TestHotReload_ConcurrencyStress (0.03s)
=== RUN   TestHotReload_LogBuffer_OOM_Prevention
--- PASS: TestHotReload_LogBuffer_OOM_Prevention (0.03s)
=== RUN   TestWriterTransparent_TruthTable
=== RUN   TestWriterTransparent_TruthTable/none
=== RUN   TestWriterTransparent_TruthTable/rf
=== RUN   TestWriterTransparent_TruthTable/h
=== RUN   TestWriterTransparent_TruthTable/rf_h
=== RUN   TestWriterTransparent_TruthTable/f
=== RUN   TestWriterTransparent_TruthTable/rf_f
=== RUN   TestWriterTransparent_TruthTable/h_f
=== RUN   TestWriterTransparent_TruthTable/rf_h_f
=== RUN   TestWriterTransparent_TruthTable/p
=== RUN   TestWriterTransparent_TruthTable/rf_p
=== RUN   TestWriterTransparent_TruthTable/h_p
=== RUN   TestWriterTransparent_TruthTable/rf_h_p
=== RUN   TestWriterTransparent_TruthTable/f_p
=== RUN   TestWriterTransparent_TruthTable/rf_f_p
=== RUN   TestWriterTransparent_TruthTable/h_f_p
=== RUN   TestWriterTransparent_TruthTable/rf_h_f_p
--- PASS: TestWriterTransparent_TruthTable (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/none (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/rf (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/h (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/rf_h (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/f (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/rf_f (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/h_f (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/rf_h_f (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/p (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/rf_p (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/h_p (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/rf_h_p (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/f_p (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/rf_f_p (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/h_f_p (0.00s)
    --- PASS: TestWriterTransparent_TruthTable/rf_h_f_p (0.00s)
=== RUN   TestWriterTransparent_StatusTracking
=== RUN   TestWriterTransparent_StatusTracking/WriteHeader
=== RUN   TestWriterTransparent_StatusTracking/Write
=== RUN   TestWriterTransparent_StatusTracking/ReadFrom
=== RUN   TestWriterTransparent_StatusTracking/Unwrap
--- PASS: TestWriterTransparent_StatusTracking (0.00s)
    --- PASS: TestWriterTransparent_StatusTracking/WriteHeader (0.00s)
    --- PASS: TestWriterTransparent_StatusTracking/Write (0.00s)
    --- PASS: TestWriterTransparent_StatusTracking/ReadFrom (0.00s)
    --- PASS: TestWriterTransparent_StatusTracking/Unwrap (0.00s)
=== RUN   TestIntentErrorMapping_Table
--- PASS: TestIntentErrorMapping_Table (0.00s)
=== RUN   TestIntentErrorMapping_ResponseShape
--- PASS: TestIntentErrorMapping_ResponseShape (0.00s)
=== RUN   TestIsNil_TypedNilTrap
--- PASS: TestIsNil_TypedNilTrap (0.00s)
=== RUN   TestSetDependencies_HandlesTypedNil
--- PASS: TestSetDependencies_HandlesTypedNil (0.00s)
=== RUN   TestProblemDetails_Compliance
=== RUN   TestProblemDetails_Compliance/Status_500_-_System_Error
=== RUN   TestProblemDetails_Compliance/Status_400_-_Invalid_Input
--- PASS: TestProblemDetails_Compliance (0.00s)
    --- PASS: TestProblemDetails_Compliance/Status_500_-_System_Error (0.00s)
    --- PASS: TestProblemDetails_Compliance/Status_400_-_Invalid_Input (0.00s)
=== RUN   TestOWIAdapter_FilesizePropagated
--- PASS: TestOWIAdapter_FilesizePropagated (0.00s)
=== RUN   TestOWIAdapter_FilesizeZeroPreserved
--- PASS: TestOWIAdapter_FilesizeZeroPreserved (0.00s)
=== RUN   TestOWIAdapter_FilesizeStringPreserved
--- PASS: TestOWIAdapter_FilesizeStringPreserved (0.00s)
=== RUN   TestGetRecordings_Contract_UpstreamFailure
--- PASS: TestGetRecordings_Contract_UpstreamFailure (0.00s)
=== RUN   TestHLSPlaylist_NoSyncPreflightIO
--- PASS: TestHLSPlaylist_NoSyncPreflightIO (0.00s)
=== RUN   TestGetRecordingHLSPlaylist_FailedPromotesReady
--- PASS: TestGetRecordingHLSPlaylist_FailedPromotesReady (0.00s)
=== RUN   TestGetRecordingHLSPlaylist_Failed_Reconcile_BuildCallbackPromotesReady
{"level":"info","jobId":"/tmp/TestGetRecordingHLSPlaylist_Failed_Reconcile_BuildCallbackPromot1845599339/001/recordings/b88707d0e76991df0f88380e6f1f942866f17fbbf70b25b592a97e346b02c842","time":"2026-02-01T14:41:26+01:00","message":"VOD build process completed successfully"}
{"level":"info","jobId":"/tmp/TestGetRecordingHLSPlaylist_Failed_Reconcile_BuildCallbackPromot1845599339/001/recordings/b88707d0e76991df0f88380e6f1f942866f17fbbf70b25b592a97e346b02c842","finalPath":"/tmp/TestGetRecordingHLSPlaylist_Failed_Reconcile_BuildCallbackPromot1845599339/001/recordings/b88707d0e76991df0f88380e6f1f942866f17fbbf70b25b592a97e346b02c842/index.m3u8","time":"2026-02-01T14:41:26+01:00","message":"VOD build published successfully"}
{"level":"info","jobId":"/tmp/TestGetRecordingHLSPlaylist_Failed_Reconcile_BuildCallbackPromot1845599339/001/recordings/b88707d0e76991df0f88380e6f1f942866f17fbbf70b25b592a97e346b02c842","metaId":"1:0:0:0:0:0:0:0:0:/media/nfs/build.ts","oldState":"PREPARING","newState":"READY","playlistPath":"/tmp/TestGetRecordingHLSPlaylist_Failed_Reconcile_BuildCallbackPromot1845599339/001/recordings/b88707d0e76991df0f88380e6f1f942866f17fbbf70b25b592a97e346b02c842/index.m3u8","stateGen":2,"time":"2026-02-01T14:41:26+01:00","message":"VOD manager: metadata updated"}
--- PASS: TestGetRecordingHLSPlaylist_Failed_Reconcile_BuildCallbackPromotesReady (0.01s)
=== RUN   TestGetRecordingHLSPlaylist_FailedStampedeTriggersSingleBuild
--- PASS: TestGetRecordingHLSPlaylist_FailedStampedeTriggersSingleBuild (0.00s)
=== RUN   TestGetRecordingHLSPlaylist_FailedLatencySLO
{"level":"info","jobId":"/tmp/TestGetRecordingHLSPlaylist_FailedLatencySLO2355552300/001/recordings/0cf2e02b8da5160dd81b286e0fae78f966f5ba2dabe812871ecabcb4d63284e3","time":"2026-02-01T14:41:26+01:00","message":"VOD build process completed successfully"}
{"level":"info","jobId":"/tmp/TestGetRecordingHLSPlaylist_FailedLatencySLO2355552300/001/recordings/0cf2e02b8da5160dd81b286e0fae78f966f5ba2dabe812871ecabcb4d63284e3","finalPath":"/tmp/TestGetRecordingHLSPlaylist_FailedLatencySLO2355552300/001/recordings/0cf2e02b8da5160dd81b286e0fae78f966f5ba2dabe812871ecabcb4d63284e3/index.m3u8","time":"2026-02-01T14:41:26+01:00","message":"VOD build published successfully"}
{"level":"info","jobId":"/tmp/TestGetRecordingHLSPlaylist_FailedLatencySLO2355552300/001/recordings/0cf2e02b8da5160dd81b286e0fae78f966f5ba2dabe812871ecabcb4d63284e3","metaId":"1:0:0:0:0:0:0:0:0:/media/nfs/latency.ts","oldState":"PREPARING","newState":"READY","playlistPath":"/tmp/TestGetRecordingHLSPlaylist_FailedLatencySLO2355552300/001/recordings/0cf2e02b8da5160dd81b286e0fae78f966f5ba2dabe812871ecabcb4d63284e3/index.m3u8","stateGen":2,"time":"2026-02-01T14:41:26+01:00","message":"VOD manager: metadata updated"}
--- PASS: TestGetRecordingHLSPlaylist_FailedLatencySLO (0.01s)
=== RUN   TestGetRecordingHLSPlaylist_OpenFailure_ReconcileReady
    recordings_hls_reconcile_test.go:313: Skipping flaky async reconciliation test
--- SKIP: TestGetRecordingHLSPlaylist_OpenFailure_ReconcileReady (0.00s)
=== RUN   TestProbeDurationIntegration
    recordings_probe_verification_test.go:39: Skipping integration test requiring full server setup
--- SKIP: TestProbeDurationIntegration (0.57s)
=== RUN   TestExtractPathFromServiceRef
=== RUN   TestExtractPathFromServiceRef/standard_enigma2_service_ref
=== RUN   TestExtractPathFromServiceRef/extended_enigma2_service_ref_with_more_colons
=== RUN   TestExtractPathFromServiceRef/path_with_spaces
=== RUN   TestExtractPathFromServiceRef/no_colon_-_return_as-is
=== RUN   TestExtractPathFromServiceRef/colon_but_no_absolute_path_-_return_as-is_(defensive)
=== RUN   TestExtractPathFromServiceRef/empty_string
=== RUN   TestExtractPathFromServiceRef/only_colons
=== RUN   TestExtractPathFromServiceRef/trailing_colon_no_path
=== RUN   TestExtractPathFromServiceRef/windows-style_path_(not_supported,_returned_as-is)
=== RUN   TestExtractPathFromServiceRef/path_with_special_characters
=== RUN   TestExtractPathFromServiceRef/path_with_unicode_characters
=== RUN   TestExtractPathFromServiceRef/path_with_url_encoding_(already_decoded)
=== RUN   TestExtractPathFromServiceRef/root_path
=== RUN   TestExtractPathFromServiceRef/deep_nested_path
--- PASS: TestExtractPathFromServiceRef (0.00s)
    --- PASS: TestExtractPathFromServiceRef/standard_enigma2_service_ref (0.00s)
    --- PASS: TestExtractPathFromServiceRef/extended_enigma2_service_ref_with_more_colons (0.00s)
    --- PASS: TestExtractPathFromServiceRef/path_with_spaces (0.00s)
    --- PASS: TestExtractPathFromServiceRef/no_colon_-_return_as-is (0.00s)
    --- PASS: TestExtractPathFromServiceRef/colon_but_no_absolute_path_-_return_as-is_(defensive) (0.00s)
    --- PASS: TestExtractPathFromServiceRef/empty_string (0.00s)
    --- PASS: TestExtractPathFromServiceRef/only_colons (0.00s)
    --- PASS: TestExtractPathFromServiceRef/trailing_colon_no_path (0.00s)
    --- PASS: TestExtractPathFromServiceRef/windows-style_path_(not_supported,_returned_as-is) (0.00s)
    --- PASS: TestExtractPathFromServiceRef/path_with_special_characters (0.00s)
    --- PASS: TestExtractPathFromServiceRef/path_with_unicode_characters (0.00s)
    --- PASS: TestExtractPathFromServiceRef/path_with_url_encoding_(already_decoded) (0.00s)
    --- PASS: TestExtractPathFromServiceRef/root_path (0.00s)
    --- PASS: TestExtractPathFromServiceRef/deep_nested_path (0.00s)
=== RUN   TestRecordingsStatusHTTP_IdleOmitsError
--- PASS: TestRecordingsStatusHTTP_IdleOmitsError (0.00s)
=== RUN   TestRecordingsStatusHTTP_MetaFailedIncludesError
--- PASS: TestRecordingsStatusHTTP_MetaFailedIncludesError (0.00s)
=== RUN   TestV3_ResponseGolden
=== RUN   TestV3_ResponseGolden/PlaybackInfo_JSON_Shape
=== RUN   TestV3_ResponseGolden/ProblemDetails_JSON_Shape
--- PASS: TestV3_ResponseGolden (0.00s)
    --- PASS: TestV3_ResponseGolden/PlaybackInfo_JSON_Shape (0.00s)
    --- PASS: TestV3_ResponseGolden/ProblemDetails_JSON_Shape (0.00s)
=== RUN   TestRouterParity_HandRouter
--- PASS: TestRouterParity_HandRouter (0.00s)
=== RUN   TestRouterParity_ProductionWiring
--- PASS: TestRouterParity_ProductionWiring (0.00s)
=== RUN   TestRouterParity_AuthZMatrix
--- PASS: TestRouterParity_AuthZMatrix (0.00s)
=== RUN   TestPlaybackInfo_SchemaCompliance
--- PASS: TestPlaybackInfo_SchemaCompliance (0.00s)
=== RUN   TestUpdateSeriesRule_Success
--- PASS: TestUpdateSeriesRule_Success (0.00s)
=== RUN   TestUpdateSeriesRule_NotFound
--- PASS: TestUpdateSeriesRule_NotFound (0.00s)
=== RUN   TestUpdateSeriesRule_EmptyKeyword
--- PASS: TestUpdateSeriesRule_EmptyKeyword (0.00s)
=== RUN   TestMapSessionState
--- PASS: TestMapSessionState (0.00s)
=== RUN   TestMapSessionReason
--- PASS: TestMapSessionReason (0.00s)
=== RUN   TestFindMountForPath
--- PASS: TestFindMountForPath (0.00s)
=== RUN   TestUnescapeMountPath
--- PASS: TestUnescapeMountPath (0.00s)
=== RUN   TestOpenAPIPresence
--- PASS: TestOpenAPIPresence (0.08s)
=== RUN   TestFactoryWiring
--- PASS: TestFactoryWiring (0.00s)
=== RUN   TestContract_PlaybackInfo_Preparing
--- PASS: TestContract_PlaybackInfo_Preparing (0.00s)
=== RUN   TestContract_PlaybackInfo_Forbidden
--- PASS: TestContract_PlaybackInfo_Forbidden (0.00s)
=== RUN   TestContract_PlaybackInfo_NotFound
--- PASS: TestContract_PlaybackInfo_NotFound (0.00s)
=== RUN   TestContract_PlaybackInfo_UpstreamError
--- PASS: TestContract_PlaybackInfo_UpstreamError (0.00s)
=== RUN   TestInvariant_SuccessAlwaysSeekable
--- PASS: TestInvariant_SuccessAlwaysSeekable (0.00s)
=== RUN   TestSystemConfigContract
--- PASS: TestSystemConfigContract (0.00s)
FAIL
FAIL	github.com/ManuGH/xg2g/internal/control/http/v3	2.100s
FAIL
