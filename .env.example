# =============================================================================
# xg2g Configuration - Environment Variables
# =============================================================================
# Copy this file to .env and edit it to match your setup:
#   cp .env.example .env
# =============================================================================

# =============================================================================
# TRANSCODING STRATEGY
# =============================================================================
# audio    = Rust FFI Audio Remux (39µs, Apple TV/Safari fix) ⭐ RECOMMENDED
# video    = GPU Full Transcode (requires XG2G_TRANSCODER_URL:8085 service)
# direct   = No processing (VLC/MPV only)
TRANSCODING_STRATEGY=audio

# --- RUST FFI (Audio Remuxer) ⭐ SPECIAL SAUCE ⭐ ---
# Ultra-fast in-memory MP2/AC3 → AAC remuxing (140x faster than FFmpeg subprocess)
# <0.1% CPU usage, 39µs latency. Critical for Apple TV/iOS/Safari compatibility.
# Requires: Docker image built with 'rust-builder' stage (default)
XG2G_USE_RUST_REMUXER=true

# --- COMPATIBILITY FIXES ---
# Fixes broken H.264 headers (PPS/SPS) from Enigma2 streams.
# Critical for Plex/Jellyfin playback to prevent "Playback Error".
XG2G_H264_STREAM_REPAIR=true

# --- GPU VIDEO (Heavy Mode) ---
# Only needed for bandwidth reduction (WAN) or burning subtitles.
# Requires separate Transcoder Service (see architecture docs).
# XG2G_TRANSCODER_URL=http://transcoder:8085
# =============================================================================

# === OpenWebIF (Enigma2 Receiver) ===
# Hostname or IP of your receiver (do not include http://)
OWI_HOST=192.168.1.100
# Web interface port (usually 80)
OWI_PORT=80
# Authentication (leave empty if not enabled)
OWI_USER=root
OWI_PASS=

# === Bouquet & Channels ===
# The bouquet to load (e.g. "Favourites", "Movies").
# Acts as a filter if your receiver has many bouquets.
DEFAULT_BOUQUET=Favourites
# Refresh channels on startup? (true/false)
INITIAL_REFRESH=true

# === Transcoding Modes ===

# MODE 1: Standard (Desktop Players)
# - Direct stream copy (No transcoding).
# - Enabled by default if other modes are disabled.

# MODE 2: Audio Transcoding (iPhone/iPad support)
# - Uses Rust remuxer (fast, low CPU).
# - Set to "true" to enable.
AUDIO_TRANSCODING_ENABLED=false

# MODE 3: GPU Video Transcoding (Experimental)
# - Requires Intel QuickSync or AMD GPU.
# - Enabled via MODE_3_ENABLED=true
MODE_3_ENABLED=false
GPU_METRICS_ENABLED=false

# === Ports ===
# WebUI and API Port
WEBUI_PORT=8080
# Stream Proxy Port (used if Transcoding/Proxy is enabled)
STREAM_PORT=18000
# GPU Direct Port (only for Mode 3)
GPU_PORT=8085

# === Production & Security ===
# API Token for protected endpoints (leave empty to disable)
# Generate: openssl rand -hex 16
API_TOKEN=

# Rate limiting (requests per second per IP)
RATE_LIMIT_RPS=10
RATE_LIMIT_BURST=20

# === Advanced Settings ===
# Audio bitrate for transcoding (e.g. 192k, 128k)
AUDIO_BITRATE=192k
# Video bitrate for GPU transcoding (e.g. 4M)
VIDEO_BITRATE=4M

# === Docker Settings ===
# User ID to run as. For desktop, typically 1000:1000.
# For LXC/Proxmox, you might need 0:0.
DOCKER_USER=0:0
# Restart policy
RESTART_POLICY=unless-stopped
