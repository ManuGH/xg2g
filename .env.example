# =============================================================================
# xg2g Configuration - Environment Variables
# =============================================================================
# Copy this file to .env and edit it to match your setup:
#   cp .env.example .env
# =============================================================================

# =============================================================================
# TRANSCODING STRATEGY
# =============================================================================
# audio    = Rust FFI Audio Remux (39µs, Apple TV/Safari fix) ⭐ RECOMMENDED
# video    = GPU Full Transcode (requires XG2G_TRANSCODER_URL:8085 service)
# direct   = No processing (VLC/MPV only)
TRANSCODING_STRATEGY=audio

# --- PRESETS (Copy & Paste) ---
#
# [Preset: Local Testing (No GPU)]
# TRANSCODING_STRATEGY=direct
# MODE_3_ENABLED=false
#
# [Preset: GPU Power User (Intel/Nvidia)]
# TRANSCODING_STRATEGY=video
# MODE_3_ENABLED=true
# XG2G_TRANSCODER_URL=http://transcoder:8085
#
# ------------------------------

# --- RUST FFI (Audio Remuxer) ⭐ SPECIAL SAUCE ⭐ ---
# Ultra-fast in-memory MP2/AC3 → AAC remuxing (140x faster than FFmpeg subprocess)
# <0.1% CPU usage, 39µs latency. Critical for Apple TV/iOS/Safari compatibility.
# Requires: Docker image built with 'rust-builder' stage (default)
XG2G_USE_RUST_REMUXER=true

# --- COMPATIBILITY FIXES ---
# Fixes broken H.264 headers (PPS/SPS) from Enigma2 streams.
# Critical for Plex/Jellyfin playback to prevent "Playback Error".
XG2G_H264_STREAM_REPAIR=true

# =============================================================================
# PLEX/iOS OPTIMIZED PROFILE
# =============================================================================
# Dedicated HLS profile for Plex Media Server and iOS devices.
# Automatically activated when Plex User-Agent is detected.
# Provides Direct Play without transcoding, fast startup, and stable streams.
# See docs/PLEX_IOS_PROFILE.md for details.

# Enable Plex/iOS profile (default: auto-enabled for Plex clients)
# XG2G_PLEX_PROFILE_ENABLED=true

# HLS segment duration in seconds (2-10, default: 2)
# Lower = faster startup, higher = more stable for slow networks
# XG2G_PLEX_SEGMENT_DURATION=2

# Number of segments in playlist (3-10, default: 3)
# Lower = faster startup, higher = more buffering tolerance
# XG2G_PLEX_PLAYLIST_SIZE=3

# Pre-buffer segments before serving playlist (1-5, default: 2)
# Ensures smooth playback from the first second
# XG2G_PLEX_STARTUP_SEGMENTS=2

# Force AAC audio transcoding for iOS compatibility (default: true)
# Set to false if your streams already have AAC audio
# XG2G_PLEX_FORCE_AAC=true

# AAC audio bitrate (default: 192k)
# Options: 128k (lower quality), 192k (recommended), 256k (high quality)
# XG2G_PLEX_AAC_BITRATE=192k

# FFmpeg path (default: /usr/bin/ffmpeg)
# XG2G_PLEX_FFMPEG_PATH=/usr/bin/ffmpeg
# =============================================================================

# =============================================================================
# LOW-LATENCY HLS (LL-HLS) - EXPERIMENTAL
# =============================================================================
# Ultra-low latency HLS using fragmented MP4 for native Apple clients.
# Automatically activated for Safari, iOS native players (not Plex).
# Reduces latency from ~6s to ~0.5-1s but requires iOS 14+/macOS 11+.
# See docs/LLHLS_PROFILE.md for details and testing instructions.

# Enable LL-HLS profile (default: auto-enabled for compatible clients)
# XG2G_LLHLS_ENABLED=true

# Segment duration in seconds (1-2, default: 1)
# Keep at 1s for optimal low-latency performance
# XG2G_LLHLS_SEGMENT_DURATION=1

# Number of segments in playlist (6-10, default: 6)
# Higher values provide more buffering tolerance
# XG2G_LLHLS_PLAYLIST_SIZE=6

# Pre-buffer segments before serving playlist (2-3, default: 2)
# XG2G_LLHLS_STARTUP_SEGMENTS=2

# Partial segment size in bytes (default: 262144 = 256KB)
# Smaller = lower latency, larger = more stable
# XG2G_LLHLS_PART_SIZE=262144

# FFmpeg path (default: /usr/bin/ffmpeg)
# XG2G_LLHLS_FFMPEG_PATH=/usr/bin/ffmpeg
# =============================================================================

# --- GPU VIDEO (Heavy Mode) ---
# Only needed for bandwidth reduction (WAN) or burning subtitles.
# Requires separate Transcoder Service (see architecture docs).
# XG2G_TRANSCODER_URL=http://transcoder:8085
# =============================================================================

# === OpenWebIF (Enigma2 Receiver) ===
# Hostname or IP of your receiver (do not include http://)
OWI_HOST=192.168.1.100
# Web interface port (usually 80)
OWI_PORT=80
# Authentication (leave empty if not enabled)
OWI_USER=root
OWI_PASS=

# === Bouquet & Channels ===
# The bouquet to load (e.g. "Favourites", "Movies").
# Acts as a filter if your receiver has many bouquets.
DEFAULT_BOUQUET=Favourites
# Refresh channels on startup? (true/false)
INITIAL_REFRESH=true

# === Transcoding Modes ===

# MODE 1: Standard (Desktop Players)
# - Direct stream copy (No transcoding).
# - Enabled by default if other modes are disabled.

# MODE 2: Audio Transcoding (iPhone/iPad support)
# - Uses Rust remuxer (fast, low CPU).
# - Set to "true" to enable.
AUDIO_TRANSCODING_ENABLED=false

# MODE 3: GPU Video Transcoding (Experimental)
# - Requires Intel QuickSync or AMD GPU.
# - Enabled via MODE_3_ENABLED=true
MODE_3_ENABLED=false
GPU_METRICS_ENABLED=false

# === Ports ===
# WebUI and API Port
WEBUI_PORT=8080
# Stream Proxy Port (used if Transcoding/Proxy is enabled)
STREAM_PORT=18000
# GPU Direct Port (only for Mode 3)
GPU_PORT=8085

# === Production & Security ===
# API Token for protected endpoints (leave empty to disable)
# Generate: openssl rand -hex 16
API_TOKEN=

# Rate limiting (requests per second per IP)
RATE_LIMIT_RPS=10
RATE_LIMIT_BURST=20

# === TLS/HTTPS Configuration ===
# Enable HTTPS with auto-generated self-signed certificates
# Set to "true" to automatically generate certificates on startup
XG2G_TLS_ENABLED=false

# Custom certificate paths (optional)
# If set, these override auto-generation. Both must be provided together.
# XG2G_TLS_CERT=certs/xg2g.crt
# XG2G_TLS_KEY=certs/xg2g.key

# Force redirect HTTP to HTTPS (requires TLS enabled)
# XG2G_FORCE_HTTPS=false

# === Advanced Settings ===
# Audio bitrate for transcoding (e.g. 192k, 128k)
AUDIO_BITRATE=192k
# Video bitrate for GPU transcoding (e.g. 4M)
VIDEO_BITRATE=4M

# === Docker Settings ===
# User ID to run as. For desktop, typically 1000:1000.
# For LXC/Proxmox, you might need 0:0.
DOCKER_USER=0:0
# Restart policy
RESTART_POLICY=unless-stopped

# ==========================================
# Safari Webplayer / LL-HLS HEVC Settings
# ==========================================
# Enable dedicated HEVC profile for Safari/Webplayer
XG2G_LLHLS_HEVC_ENABLED=false

# FFmpeg Encoder (hevc_nvenc, hevc_vaapi, libx265)
# Ensure your hardware/container has the device passed through!
XG2G_LLHLS_HEVC_ENCODER=hevc_nvenc

# Video Quality Settings
XG2G_LLHLS_HEVC_BITRATE=6000k
XG2G_LLHLS_HEVC_PEAK=8000k
XG2G_LLHLS_HEVC_PROFILE=main
XG2G_LLHLS_HEVC_LEVEL=5.0
