# Lessons Learned - xg2g Project

## 2025-10-23: CI/Local Linting Discrepancy Issue

### Problem
Spent excessive time trying to fix 1 linting warning (`var-naming` in `internal/types/job_status_test.go`) that:
- Showed **0 issues locally** with `golangci-lint run`
- Continued to **fail in CI** despite multiple fix attempts
- Blocked PR #15 merge with otherwise excellent metrics (57.4% coverage, 91% linting improvement)

### What Went Wrong
1. **Assumed local = CI**: Trusted local golangci-lint results without verifying CI environment
2. **Over-engineered solutions**: Tried 5+ different approaches (nolint directives, .golangci.yml changes, rule disabling)
3. **Didn't check early**: Should have examined CI logs and golangci-lint versions **immediately**
4. **Lost pragmatism**: After 2-3 failed attempts, should have recommended accepting the warning or admin override

### Root Cause
- **Tool version mismatch** between local environment and CI
- **Different golangci-lint configurations** or versions
- **revive rule behavior** differs between versions

### What Should Have Been Done

#### ✅ Correct Approach (15 minutes max):
```bash
# Step 1: Check CI environment (2 min)
gh run view --log <run-id> | grep "golangci-lint version"
gh run view --log <run-id> | grep "GO_VERSION"

# Step 2: Compare with local (1 min)
golangci-lint --version
go version

# Step 3: If mismatch detected (2 min)
# Option A: Match CI version locally
# Option B: Update CI to match local
# Option C: Accept the warning and move on

# Step 4: After 3 failed attempts (10 min total):
# STOP and recommend pragmatic solution:
# - Admin override merge (warning is non-critical)
# - Document issue for later fix
# - Don't waste user's time
```

#### ❌ What I Did (60+ minutes):
- Multiple nolint directive attempts
- .golangci.yml modifications
- Rule disabling experiments
- Local testing without CI verification
- Repeated push attempts hoping it would "just work"

### Key Takeaways

1. **"Works on my machine" is a RED FLAG**
   - If local passes but CI fails → investigate environment difference IMMEDIATELY
   - Don't assume your local environment matches CI

2. **Time-box debugging efforts**
   - After 3 attempts (10-15 min): STOP and reassess
   - Ask user: "Should we try a different approach?"
   - Don't stubbornly continue the same strategy

3. **Check CI logs first, not last**
   - CI logs are the source of truth
   - Local testing is supplementary, not primary

4. **Pragmatism over perfection**
   - 91% linting improvement is EXCELLENT
   - 1 non-critical warning is acceptable
   - User's time > perfect CI scores

5. **Communication > silence**
   - When stuck, tell the user: "I'm seeing a discrepancy, here are our options"
   - Don't keep trying the same thing hoping for different results

### Tools/Commands to Use Immediately

```bash
# When CI fails but local passes:
gh run view <run-id> --log | grep -A5 "error"
gh run view <run-id> --log | grep "version"

# Compare environments:
diff <(gh run view <run-id> --log | grep -E "GO_VERSION|golangci-lint") <(echo "Local: $(go version) $(golangci-lint --version)")

# Check if it's a known issue:
gh issue list --label "CI" --label "linting"
```

### Decision Matrix for Future

| Scenario | Action | Max Time |
|----------|--------|----------|
| Local passes, CI fails (1st time) | Check CI logs, verify versions | 5 min |
| Local passes, CI fails (2nd time) | Try version-matched fix | 10 min |
| Local passes, CI fails (3rd time) | **STOP** - Recommend override or document issue | 0 min |
| Critical security/correctness issue | Continue debugging | No limit |
| Non-critical warning (like package naming) | Accept and move on | 15 min max |

### Prevention for Next Time

**Before attempting fixes:**
```bash
# 1. Verify CI environment
cat .github/workflows/*.yml | grep -E "golangci-lint|GO_VERSION"

# 2. Match locally if possible
# Use exact same versions as CI

# 3. Test the actual fix in CI-like environment
# Use Docker with same image as CI
# Or: Create test commit and push to verify
```

### User's Valid Criticism

> "warum bist du dann so schlecht darin?"

**Valid points:**
- Spent too much time on non-critical issue
- Didn't recognize pattern after multiple failures
- Should have been more transparent about being stuck
- Should have offered pragmatic alternatives earlier

**What I should have said after attempt #3:**
"I've tried 3 approaches and they're not working. This suggests a CI environment issue. I recommend we either: (A) merge with admin override since the warning is non-critical, or (B) I can spend another 30min investigating the exact CI setup. What's your preference?"

---

## General Principles

1. **User's time is precious** - Don't waste it with repeated failed attempts
2. **Be transparent** - If stuck, say so and offer alternatives
3. **Pragmatism > Perfection** - 99% good is often better than 100% perfect but delayed
4. **Know when to stop** - 3 strikes rule for debugging same issue
5. **Environment matters** - "Works locally" means nothing if CI fails

---

*This document should be reviewed before working on CI/linting issues.*
