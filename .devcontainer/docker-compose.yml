version: '3.8'

services:
  dev:
    build:
      context: ..
      dockerfile: .devcontainer/Dockerfile

    volumes:
      - ../:/workspace:cached
      - go-cache:/go/pkg
      - cargo-cache:/usr/local/cargo/registry

    command: sleep infinity

    environment:
      # Go configuration
      - GOCACHE=/go/pkg/cache
      - GOPATH=/go

      # Development defaults
      - XG2G_LOG_LEVEL=debug
      - XG2G_LISTEN=:8080
      - XG2G_METRICS_LISTEN=:9090
      - XG2G_DATA=/workspace/data

    network_mode: "host"

    cap_add:
      - SYS_PTRACE

    security_opt:
      - seccomp:unconfined

volumes:
  go-cache:
  cargo-cache:
