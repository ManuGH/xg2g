events {
    worker_connections 1024;
}

http {
    # Stream-Proxy für Enigma2 Stream Relay (Port 17999)
    # Beantwortet HEAD-Requests ohne sie an Enigma2 weiterzuleiten
    server {
        listen 17999;
        server_name _;

        # Logging
        access_log /dev/stdout;
        error_log /dev/stderr info;

        # Proxy-Settings
        proxy_buffering off;
        proxy_request_buffering off;
        proxy_http_version 1.1;
        proxy_set_header Connection "";

        # Keine Timeouts für Streams
        proxy_read_timeout 3600s;
        proxy_send_timeout 3600s;
        proxy_connect_timeout 10s;

        location / {
            # HEAD-Requests direkt beantworten ohne sie weiterzuleiten
            if ($request_method = HEAD) {
                add_header Content-Type "video/mp2t";
                add_header Accept-Ranges "none";
                # Keine Content-Length (chunked encoding für Streams)
                return 200;
            }

            # GET/POST Requests an Enigma2 Stream Relay weiterleiten
            proxy_pass http://10.10.55.57:17999;
        }
    }
}
