name: UI Contract Enforcement

on:
  pull_request:
    paths:
      - "webui/src/components/Dashboard.*"
      - "webui/src/components/ui/**"
      - "webui/src/components/Navigation.*"
      - "webui/src/components/SystemHealthPanel.*"
      - "webui/src/index.css"

jobs:
  ui-contract-gate:
    name: Check UI Design Contract
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Run UI Contract Gates
        run: |
          chmod +x ./scripts/check-ui-contract.sh
          # Scoped check: only Dashboard + primitives
          ./scripts/check-ui-contract.sh \
            components/Dashboard.tsx \
            components/Dashboard.css \
            components/ui/Card.tsx \
            components/ui/Card.css \
            components/ui/StatusChip.tsx \
            components/ui/StatusChip.css \
            components/SystemHealthPanel.tsx \
            components/SystemHealthPanel.css \
            components/Navigation.tsx \
            components/Navigation.css \
            components/RecordingsList.tsx \
            components/Recordings.css
        working-directory: ${{ github.workspace }}

      - name: Comment on PR (if failed)
        if: failure()
        uses: actions/github-script@v8
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## ‚ùå UI Contract Gates Failed
              
              The automated UI contract enforcement detected violations.
              
              **Common violations:**
              - Hardcoded hex colors (use \`var(--token-name)\`)
              - Custom \`box-shadow\` (use primitives or \`var(--shadow-*)\`)
              - Infinite animations outside primitives
              - Hardcoded gradients
              
              **To fix:**
              1. Run \`./scripts/check-ui-contract.sh\` locally
              2. Use Card and StatusChip primitives
              3. Only use design tokens from \`index.css\`
              
              See [DESIGN.md](../blob/main/webui/DESIGN.md) for the contract.`
            })
